---
---

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Remote Sensing & Classification</title>
<meta name="description" content="">
<link rel="canonical" href="http://cyberhelp.sesync.org/remote-sensing-classification-lesson/course/archive.html">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sesync-ci/lesson-style@v1.3/docs/css/default.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sesync-ci/lesson-style@v1.3/docs/css/static.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>

  </head>
  <body>
    <div class="page-content">
      <div class="wrapper">
        
        
<h1 style="text-transform: none;" id="remote-sensing--classification">Remote Sensing &amp; Classification</h1>

<h2 style="text-transform: none;" id="hurricane-inundation">Hurricane Inundation</h2>

<p>Lesson 3 with <em>Benoit Parmentier</em></p>

<h2 id="contents">Contents</h2>

<ul>
  <li><a href="#/slides/part1">Introduction to Remote Sensing</a></li>
  <li><a href="#/slides/part2">Flood Mapping Analyses</a></li>
</ul>

<hr />

<p><a name="/slides/part1"></a></p>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">####################################  Introduction to Remote Sensing   #######################################</span><span class="w">
</span><span class="c1">############################  Analyze and map flooding from RITA hurricane  #######################################</span><span class="w">
</span><span class="c1">#This script performs analyses for the Exercise 5 of the Short Course using reflectance data derived from MODIS.</span><span class="w">
</span><span class="c1">#The goal is to map flooding from RITA using various reflectance bands from Remote Sensing platforms.</span><span class="w">
</span><span class="c1">#Additional data is provided including FEMA flood region. </span><span class="w">
</span><span class="c1">#</span><span class="w">
</span><span class="c1">#AUTHORS: Benoit Parmentier                                             </span><span class="w">
</span><span class="c1">#DATE CREATED: 03/05/2018 </span><span class="w">
</span><span class="c1">#DATE MODIFIED: 03/31/2018</span><span class="w">
</span><span class="c1">#Version: 1</span><span class="w">
</span><span class="c1">#PROJECT: SESYNC and AAG 2018 Geospatial Short Course and workshop preparation</span><span class="w">
</span><span class="c1">#TO DO:</span><span class="w">
</span><span class="c1">#</span><span class="w">
</span><span class="c1">#COMMIT: clean up of code</span><span class="w">
</span><span class="c1">#</span><span class="w">
</span><span class="c1">#################################################################################################</span><span class="w">

</span><span class="c1">###Loading R library and packages                                                      </span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span><span class="w"> </span><span class="c1"># spatial/geographfic objects and functions</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rgdal</span><span class="p">)</span><span class="w"> </span><span class="c1">#GDAL/OGR binding for R with functionalities</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rgdal: version: 1.2-18, (SVN revision 718)
 Geospatial Data Abstraction Library extensions to R successfully loaded
 Loaded GDAL runtime: GDAL 2.1.3, released 2017/20/01
 Path to GDAL shared files: /usr/share/gdal/2.1
 GDAL binary built with GEOS: TRUE 
 Loaded PROJ.4 runtime: Rel. 4.9.2, 08 September 2015, [PJ_VERSION: 492]
 Path to PROJ.4 shared files: (autodetected)
 Linking to sp version: 1.2-7 
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">spdep</span><span class="p">)</span><span class="w"> </span><span class="c1">#spatial analyses operations, functions etc.</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Loading required package: Matrix
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Loading required package: spData
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">To</span> <span class="n">access</span> <span class="n">larger</span> <span class="n">datasets</span> <span class="k">in</span> <span class="n">this</span> <span class="k">package</span><span class="p">,</span> <span class="n">install</span> <span class="n">the</span> <span class="n">spDataLarge</span>
<span class="k">package</span> <span class="k">with</span><span class="p">:</span> <span class="p">`</span><span class="n">install</span><span class="p">.</span><span class="n">packages</span><span class="p">(</span><span class="s1">'spDataLarge'</span><span class="p">,</span>
<span class="n">repos</span><span class="p">=</span><span class="s1">'https://nowosad.github.io/drat/'</span><span class="p">,</span> <span class="n">type</span><span class="p">=</span><span class="s1">'source'</span><span class="p">))`</span>
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">gtools</span><span class="p">)</span><span class="w"> </span><span class="c1"># contains mixsort and other useful functions</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">maptools</span><span class="p">)</span><span class="w"> </span><span class="c1"># tools to manipulate spatial data</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Checking rgeos availability: TRUE
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">parallel</span><span class="p">)</span><span class="w"> </span><span class="c1"># parallel computation, part of base package no</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rasterVis</span><span class="p">)</span><span class="w"> </span><span class="c1"># raster visualization operations</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Loading required package: raster
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Loading required package: lattice
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Loading required package: latticeExtra
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Loading required package: RColorBrewer
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span><span class="w"> </span><span class="c1"># raster functionalities</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">forecast</span><span class="p">)</span><span class="w"> </span><span class="c1">#ARIMA forecasting</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">xts</span><span class="p">)</span><span class="w"> </span><span class="c1">#extension for time series object and analyses</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Loading required package: zoo
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Attaching package: 'zoo'
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following objects are masked from 'package:base':

    as.Date, as.Date.numeric
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">zoo</span><span class="p">)</span><span class="w"> </span><span class="c1"># time series object and analysis</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span><span class="w"> </span><span class="c1"># dates functionality</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Attaching package: 'lubridate'
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following object is masked from 'package:base':

    date
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">colorRamps</span><span class="p">)</span><span class="w"> </span><span class="c1">#contains matlab.like color palette</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rgeos</span><span class="p">)</span><span class="w"> </span><span class="c1">#contains topological operations</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rgeos version: 0.3-26, (SVN revision 560)
 GEOS runtime version: 3.5.1-CAPI-1.9.1 r4246 
 Linking to sp version: 1.2-5 
 Polygon checking: TRUE 
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">sphet</span><span class="p">)</span><span class="w"> </span><span class="c1">#contains spreg, spatial regression modeling</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Attaching package: 'sphet'
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following object is masked from 'package:raster':

    distance
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">BMS</span><span class="p">)</span><span class="w"> </span><span class="c1">#contains hex2bin and bin2hex, Bayesian methods</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">bitops</span><span class="p">)</span><span class="w"> </span><span class="c1"># function for bitwise operations</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">foreign</span><span class="p">)</span><span class="w"> </span><span class="c1"># import datasets from SAS, spss, stata and other sources</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">gdata</span><span class="p">)</span><span class="w"> </span><span class="c1">#read xls, dbf etc., not recently updated but useful</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdata: read.xls support for 'XLS' (Excel 97-2004) files ENABLED.
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdata: read.xls support for 'XLSX' (Excel 2007+) files ENABLED.
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Attaching package: 'gdata'
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following objects are masked from 'package:xts':

    first, last
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following objects are masked from 'package:raster':

    resample, trim
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following object is masked from 'package:stats':

    nobs
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following object is masked from 'package:utils':

    object.size
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following object is masked from 'package:base':

    startsWith
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">classInt</span><span class="p">)</span><span class="w"> </span><span class="c1">#methods to generate class limits</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="w"> </span><span class="c1">#data wrangling: various operations for splitting, combining data</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Attaching package: 'plyr'
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following object is masked from 'package:lubridate':

    here
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#library(gstat) #spatial interpolation and kriging methods</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">readxl</span><span class="p">)</span><span class="w"> </span><span class="c1">#functionalities to read in excel type data</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">psych</span><span class="p">)</span><span class="w"> </span><span class="c1">#pca/eigenvector decomposition functionalities</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Attaching package: 'psych'
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following object is masked from 'package:gtools':

    logit
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span><span class="w"> </span><span class="c1"># spatial objects classes</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Linking to GEOS 3.5.1, GDAL 2.1.3, proj.4 4.9.2
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">plotrix</span><span class="p">)</span><span class="w"> </span><span class="c1">#various graphic functions e.g. draw.circle</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Attaching package: 'plotrix'
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following object is masked from 'package:psych':

    rescale
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">###### Functions used in this script</span><span class="w">

</span><span class="n">create_dir_fun</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">outDir</span><span class="p">,</span><span class="n">out_suffix</span><span class="o">=</span><span class="kc">NULL</span><span class="p">){</span><span class="w">
  </span><span class="c1">#if out_suffix is not null then append out_suffix string</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">out_suffix</span><span class="p">)){</span><span class="w">
    </span><span class="n">out_name</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"output_"</span><span class="p">,</span><span class="n">out_suffix</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w">
    </span><span class="n">outDir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="n">outDir</span><span class="p">,</span><span class="n">out_name</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="c1">#create if does not exists</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">file.exists</span><span class="p">(</span><span class="n">outDir</span><span class="p">)){</span><span class="w">
    </span><span class="n">dir.create</span><span class="p">(</span><span class="n">outDir</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">outDir</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1">#####  Parameters and argument set up ###########</span><span class="w">

</span><span class="c1">#in_dir_reflectance &lt;- "data/reflectance_RITA"</span><span class="w">
</span><span class="n">in_dir_var</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"../data"</span><span class="w">
</span><span class="n">out_dir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"."</span><span class="w">

</span><span class="c1">#region coordinate reference system</span><span class="w">
</span><span class="c1">#http://spatialreference.org/ref/epsg/nad83-texas-state-mapping-system/proj4/</span><span class="w">
</span><span class="n">CRS_reg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"+proj=lcc +lat_1=27.41666666666667 +lat_2=34.91666666666666 +lat_0=31.16666666666667 +lon_0=-100 +x_0=1000000 +y_0=1000000 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"</span><span class="w"> 
</span><span class="n">file_format</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">".tif"</span><span class="w"> </span><span class="c1"># Output format for raster images that are written out.</span><span class="w">
</span><span class="n">NA_flag_val</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">-9999</span><span class="w">
</span><span class="n">out_suffix</span><span class="w"> </span><span class="o">&lt;-</span><span class="s2">"exercise5_03312018"</span><span class="w"> </span><span class="c1">#output suffix for the files and ouptu folder #PARAM 8</span><span class="w">
</span><span class="n">create_out_dir_param</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">TRUE</span><span class="w"> 

</span><span class="c1">### Input data files used:</span><span class="w">
</span><span class="n">infile_reg_outline</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"new_strata_rita_10282017"</span><span class="w"> </span><span class="c1"># Region outline and FEMA zones</span><span class="w">
</span><span class="n">infile_modis_bands_information</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"df_modis_band_info.txt"</span><span class="w"> </span><span class="c1"># MOD09 bands information.</span><span class="w">
</span><span class="n">nlcd_2006_filename</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"nlcd_2006_RITA.tif"</span><span class="w"> </span><span class="c1"># NLCD2006 Land cover data aggregated at ~ 1km.</span><span class="w">
</span><span class="n">infile_name_nlcd_legend</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"nlcd_legend.txt"</span><span class="w"> </span><span class="c1">#Legend information for 2006 NLCD.</span><span class="w">
</span><span class="c1">#MOD09 surface reflectance product on 2005-09-22 or day of year 2005265</span><span class="w">
</span><span class="n">infile_reflectance_date1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"mosaiced_MOD09A1_A2005265__006_reflectance_masked_RITA_reg_1km.tif"</span><span class="w">
</span><span class="c1">#MOD09 surface reflectance product on 2005-09-30 or day of year 2005273</span><span class="w">
</span><span class="n">infile_reflectance_date2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"mosaiced_MOD09A1_A2005273__006_reflectance_masked_RITA_reg_1km.tif"</span><span class="w">

</span><span class="c1">################# START SCRIPT ###############################</span><span class="w">

</span><span class="c1">### PART I: READ AND PREPARE DATA FOR ANALYSES #######</span><span class="w">

</span><span class="c1">## First create an output directory</span><span class="w">

</span><span class="k">if</span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)){</span><span class="w">
  </span><span class="n">out_dir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dirname</span><span class="p">(</span><span class="n">in_dir</span><span class="p">)</span><span class="w"> </span><span class="c1">#output will be created in the input dir</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">out_suffix_s</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">out_suffix</span><span class="w"> </span><span class="c1">#can modify name of output suffix</span><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="n">create_out_dir_param</span><span class="o">==</span><span class="kc">TRUE</span><span class="p">){</span><span class="w">
  </span><span class="n">out_dir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">create_dir_fun</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span><span class="n">out_suffix_s</span><span class="p">)</span><span class="w">
  </span><span class="n">setwd</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="w">
  </span><span class="n">setwd</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span><span class="w"> </span><span class="c1">#use previoulsy defined directory</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1">##### PART I: DISPLAY AND EXPLORE DATA ##############</span><span class="w">

</span><span class="c1">###### Read in MOD09 reflectance images before and after Hurrican Rita.</span><span class="w">
</span><span class="n">r_before</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">brick</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">in_dir_var</span><span class="p">,</span><span class="n">infile_reflectance_date1</span><span class="p">))</span><span class="w"> </span><span class="c1"># Before RITA, Sept. 22, 2005.</span><span class="w">
</span><span class="n">r_after</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">brick</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">in_dir_var</span><span class="p">,</span><span class="n">infile_reflectance_date2</span><span class="p">))</span><span class="w"> </span><span class="c1"># After RITA, Sept 30, 2005.</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="n">r_before</span><span class="p">)</span><span class="w"> </span><span class="c1"># Note that this is a multibands image.</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-1.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">reg_sf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_read</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">in_dir_var</span><span class="p">,</span><span class="n">infile_reg_outline</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Reading layer `new_strata_rita_10282017' from data source `/nfs/public-data/training/new_strata_rita_10282017' using driver `ESRI Shapefile'
Simple feature collection with 2 features and 17 fields
geometry type:  MULTIPOLYGON
dimension:      XY
bbox:           xmin: -93.92921 ymin: 29.47236 xmax: -91.0826 ymax: 30.49052
epsg (SRID):    4269
proj4string:    +proj=longlat +datum=NAD83 +no_defs
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">reg_sf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_transform</span><span class="p">(</span><span class="n">reg_sf</span><span class="p">,</span><span class="w">
                       </span><span class="n">crs</span><span class="o">=</span><span class="n">CRS_reg</span><span class="p">)</span><span class="w">
</span><span class="n">reg_sp</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">as</span><span class="p">(</span><span class="n">reg_sf</span><span class="p">,</span><span class="w"> </span><span class="s2">"Spatial"</span><span class="p">)</span><span class="w"> </span><span class="c1">#Convert to sp object before rasterization</span><span class="w">

</span><span class="n">r_ref</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rasterize</span><span class="p">(</span><span class="n">reg_sp</span><span class="p">,</span><span class="w">
                   </span><span class="n">r_before</span><span class="p">,</span><span class="w">
                   </span><span class="n">field</span><span class="o">=</span><span class="s2">"OBJECTID_1"</span><span class="p">,</span><span class="w">
                   </span><span class="n">fun</span><span class="o">=</span><span class="s2">"first"</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">r_ref</span><span class="p">)</span><span class="w"> </span><span class="c1"># zone 2 is flooded and zone 1 is not flooded</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-2.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#### Let's examine a location within FEMA flooded zone and outside: use centroids</span><span class="w">
</span><span class="n">centroids_sf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_centroid</span><span class="p">(</span><span class="n">reg_sf</span><span class="p">)</span><span class="w">

</span><span class="n">df_before</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">extract</span><span class="p">(</span><span class="n">r_before</span><span class="p">,</span><span class="n">centroids_sf</span><span class="p">)</span><span class="w">
</span><span class="n">df_after</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">extract</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="n">centroids_sf</span><span class="p">)</span><span class="w">

</span><span class="c1">### Plot values of bands before and after for flooded region:</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">df_before</span><span class="p">[</span><span class="m">2</span><span class="p">,],</span><span class="n">type</span><span class="o">=</span><span class="s2">"l"</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="n">df_after</span><span class="p">[</span><span class="m">2</span><span class="p">,],</span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-3.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">## Read band information since it is more informative!!</span><span class="w">
</span><span class="n">df_modis_band_info</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">in_dir_var</span><span class="p">,</span><span class="n">infile_modis_bands_information</span><span class="p">),</span><span class="w">
                                 </span><span class="n">sep</span><span class="o">=</span><span class="s2">","</span><span class="p">,</span><span class="w">
                                 </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">df_modis_band_info</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  band_name band_number start_wlength end_wlength
1       Red           3           620         670
2       NIR           4           841         876
3      Blue           1           459         479
4     Green           2           545         565
5     SWIR1           5          1230        1250
6     SWIR2           6          1628        1652
7     SWIR3           7          2105        2155
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">r_before</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_modis_band_info</span><span class="o">$</span><span class="n">band_name</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">r_after</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_modis_band_info</span><span class="o">$</span><span class="n">band_name</span><span class="w">

</span><span class="c1">### Order band in terms of wavelenth:</span><span class="w">

</span><span class="n">df_modis_band_info</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_modis_band_info</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">df_modis_band_info</span><span class="o">$</span><span class="n">start_wlength</span><span class="p">),]</span><span class="w">
</span><span class="c1">#SWIR1 (1230–1250 nm), SWIR2 (1628–1652 nm) and SWIR3 (2105–2155 nm).</span><span class="w">
</span><span class="n">band_refl_order</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_modis_band_info</span><span class="o">$</span><span class="n">band_number</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="n">df_before</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="n">band_refl_order</span><span class="p">],</span><span class="n">type</span><span class="o">=</span><span class="s2">"l"</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Bands"</span><span class="p">,</span><span class="w">
     </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Reflectance"</span><span class="p">,</span><span class="w">
     </span><span class="n">main</span><span class="o">=</span><span class="s2">"Reflectance profile for centroid of flooded area"</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="n">df_after</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="n">band_refl_order</span><span class="p">],</span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="w">
</span><span class="n">names_vals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Before Rita"</span><span class="p">,</span><span class="s2">"After Rita"</span><span class="p">)</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topleft"</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="n">names_vals</span><span class="p">,</span><span class="w">
       </span><span class="n">pt.cex</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"black"</span><span class="p">,</span><span class="s2">"red"</span><span class="p">),</span><span class="w">
       </span><span class="n">lty</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="c1">#add circle symbol to line</span><span class="w">
       </span><span class="n">bty</span><span class="o">=</span><span class="s2">"n"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-4.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">###############################################</span><span class="w">
</span><span class="c1">##### PART II: Examine spectral class signatures for land cover NLCD classes ##############</span><span class="w">

</span><span class="c1">###### Read in NLDC 2006, note that it was aggregated at 1km.</span><span class="w">
</span><span class="n">nlcd2006_reg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">in_dir_var</span><span class="p">,</span><span class="n">nlcd_2006_filename</span><span class="p">))</span><span class="w">
</span><span class="c1">#### Extract zonal averages by NLCD classes using zonal raster</span><span class="w">
</span><span class="n">avg_reflectance_nlcd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">zonal</span><span class="p">(</span><span class="n">r_before</span><span class="p">,</span><span class="n">nlcd2006_reg</span><span class="p">,</span><span class="n">fun</span><span class="o">=</span><span class="s2">"mean"</span><span class="p">))</span><span class="w">

</span><span class="c1">#### read in NLCD legend to add to the average information</span><span class="w">
</span><span class="n">lc_legend_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">in_dir_var</span><span class="p">,</span><span class="n">infile_name_nlcd_legend</span><span class="p">),</span><span class="w">
                           </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">,</span><span class="w">
                           </span><span class="n">sep</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">avg_reflectance_nlcd</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   zone        Red        NIR       Blue      Green      SWIR1      SWIR2
1     0 0.03458904 0.01535499 0.03581749 0.05163573 0.01262342 0.01771813
2    11 0.07307984 0.06784635 0.06036733 0.07956521 0.05991636 0.04664948
3    21 0.07276522 0.28171285 0.04420428 0.07726309 0.31805232 0.23408753
4    22 0.08235028 0.27960481 0.05117458 0.08538413 0.30907538 0.23123385
5    23 0.10574247 0.26636831 0.06789142 0.10388469 0.29315783 0.23319375
6    24 0.12368051 0.24758425 0.08174059 0.11712968 0.27622949 0.23576209
7    31 0.09874217 0.13020133 0.07870421 0.09989436 0.12222435 0.09422932
8    41 0.05644301 0.26516752 0.03530746 0.06259356 0.28388245 0.18083792
9    42 0.03990187 0.27645189 0.02177976 0.04993706 0.28957741 0.17166508
10   43 0.03941129 0.28346313 0.02211763 0.05035833 0.30668417 0.18516430
11   52 0.04540521 0.27760067 0.02405570 0.05334825 0.30194988 0.19117841
12   71 0.05569214 0.27195001 0.03005173 0.06076262 0.30610093 0.20940236
13   81 0.07483913 0.27795804 0.04250243 0.07692526 0.32523050 0.24754272
14   82 0.08456354 0.27472078 0.04777970 0.08379540 0.31051877 0.24309384
15   90 0.03852322 0.23273819 0.02317667 0.04775357 0.25516940 0.15667656
16   95 0.06208044 0.19687418 0.03674701 0.06434722 0.21390883 0.15373826
        SWIR3
1  0.01260556
2  0.02672107
3  0.11926512
4  0.12615517
5  0.14802151
6  0.15738439
7  0.05498403
8  0.07959769
9  0.07041540
10 0.07498740
11 0.08314305
12 0.09997039
13 0.12366634
14 0.13108070
15 0.06237482
16 0.07421595
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">lc_legend_df</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "ID"                         "COUNT"                     
[3] "Red"                        "Green"                     
[5] "Blue"                       "NLCD.2006.Land.Cover.Class"
[7] "Opacity"                   
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">### Add relevant categories</span><span class="w">
</span><span class="n">lc_legend_df_subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">lc_legend_df</span><span class="p">,</span><span class="n">select</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"ID"</span><span class="p">,</span><span class="s2">"NLCD.2006.Land.Cover.Class"</span><span class="p">))</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">lc_legend_df_subset</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"ID"</span><span class="p">,</span><span class="s2">"cat_name"</span><span class="p">)</span><span class="w">

</span><span class="n">avg_reflectance_nlcd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">avg_reflectance_nlcd</span><span class="p">,</span><span class="n">lc_legend_df_subset</span><span class="p">,</span><span class="n">by.x</span><span class="o">=</span><span class="s2">"zone"</span><span class="p">,</span><span class="n">by.y</span><span class="o">=</span><span class="s2">"ID"</span><span class="p">,</span><span class="n">all.y</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">avg_reflectance_nlcd</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  zone        Red        NIR       Blue      Green      SWIR1      SWIR2
1    0 0.03458904 0.01535499 0.03581749 0.05163573 0.01262342 0.01771813
2   11 0.07307984 0.06784635 0.06036733 0.07956521 0.05991636 0.04664948
3   21 0.07276522 0.28171285 0.04420428 0.07726309 0.31805232 0.23408753
4   22 0.08235028 0.27960481 0.05117458 0.08538413 0.30907538 0.23123385
5   23 0.10574247 0.26636831 0.06789142 0.10388469 0.29315783 0.23319375
6   24 0.12368051 0.24758425 0.08174059 0.11712968 0.27622949 0.23576209
       SWIR3                    cat_name
1 0.01260556                Unclassified
2 0.02672107                  Open Water
3 0.11926512       Developed, Open Space
4 0.12615517    Developed, Low Intensity
5 0.14802151 Developed, Medium Intensity
6 0.15738439   Developed, High Intensity
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">avg_reflectance_nlcd</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "zone"     "Red"      "NIR"      "Blue"     "Green"    "SWIR1"   
[7] "SWIR2"    "SWIR3"    "cat_name"
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">col_ordering</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">band_refl_order</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">avg_reflectance_nlcd</span><span class="p">[</span><span class="m">9</span><span class="p">,</span><span class="n">col_ordering</span><span class="p">]),</span><span class="w">
     </span><span class="n">type</span><span class="o">=</span><span class="s2">"l"</span><span class="p">,</span><span class="w">
     </span><span class="n">col</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"bands"</span><span class="p">,</span><span class="w">
     </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"reflectance"</span><span class="p">)</span><span class="w"> </span><span class="c1">#42 evergreen forest</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">avg_reflectance_nlcd</span><span class="p">[</span><span class="m">6</span><span class="p">,</span><span class="n">col_ordering</span><span class="p">]),</span><span class="w">
      </span><span class="n">type</span><span class="o">=</span><span class="s2">"l"</span><span class="p">,</span><span class="w">
      </span><span class="n">col</span><span class="o">=</span><span class="s2">"darkred"</span><span class="p">)</span><span class="w"> </span><span class="c1">#22 developed,High intensity</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-5.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">####### Explore data in Feature space:</span><span class="w">

</span><span class="c1">#Feature space NIR1 and Red</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">r_before</span><span class="o">$</span><span class="n">Red</span><span class="p">,</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">NIR</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-6.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_before</span><span class="o">$</span><span class="n">Green</span><span class="p">,</span><span class="n">r_before</span><span class="o">$</span><span class="n">Red</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-7.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_before</span><span class="o">$</span><span class="n">SWIR1</span><span class="p">,</span><span class="n">r_before</span><span class="o">$</span><span class="n">NIR</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-8.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_before</span><span class="o">$</span><span class="n">Red</span><span class="p">,</span><span class="n">r_before</span><span class="o">$</span><span class="n">SWIR1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-9.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">df_r_before_nlcd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">stack</span><span class="p">(</span><span class="n">r_before</span><span class="p">,</span><span class="n">nlcd2006_reg</span><span class="p">))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">df_r_before_nlcd</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>         Red       NIR       Blue      Green     SWIR1     SWIR2
1 0.03599200 0.2599244 0.02133671 0.04703750 0.2810231 0.1553841
2 0.02928869 0.2715889 0.01696460 0.04409311 0.2720489 0.1396950
3 0.02671438 0.2838178 0.01695321 0.04189149 0.2874987 0.1507025
4 0.02691096 0.2825994 0.01606729 0.04149844 0.2870458 0.1528974
5 0.04274514 0.2800327 0.02311076 0.05212086 0.3009017 0.1827510
6 0.03583299 0.2768207 0.02156925 0.04826682 0.2877768 0.1600456
       SWIR3 nlcd_2006_RITA
1 0.05624928             NA
2 0.04715122             NA
3 0.04982105             NA
4 0.05246148             NA
5 0.07394192             NA
6 0.05998935             NA
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#Evergreen Forest:</span><span class="w">
</span><span class="n">df_subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">df_r_before_nlcd</span><span class="p">,</span><span class="n">nlcd_2006_RITA</span><span class="o">==</span><span class="m">42</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">df_subset</span><span class="o">$</span><span class="n">Green</span><span class="p">,</span><span class="w">
     </span><span class="n">df_subset</span><span class="o">$</span><span class="n">Red</span><span class="p">,</span><span class="w">
     </span><span class="n">col</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span><span class="w">
     </span><span class="n">cex</span><span class="o">=</span><span class="m">0.15</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Green"</span><span class="p">,</span><span class="w">
     </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Red"</span><span class="p">,</span><span class="w">
     </span><span class="n">main</span><span class="o">=</span><span class="s2">"Green-Red feature space"</span><span class="p">)</span><span class="w">

</span><span class="c1">#Urban: dense</span><span class="w">
</span><span class="n">df_subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">df_r_before_nlcd</span><span class="p">,</span><span class="n">nlcd_2006_RITA</span><span class="o">==</span><span class="m">22</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">df_subset</span><span class="o">$</span><span class="n">Green</span><span class="p">,</span><span class="w">
       </span><span class="n">df_subset</span><span class="o">$</span><span class="n">Red</span><span class="p">,</span><span class="w">
       </span><span class="n">col</span><span class="o">=</span><span class="s2">"darkred"</span><span class="p">,</span><span class="w">
       </span><span class="n">cex</span><span class="o">=</span><span class="m">0.15</span><span class="p">)</span><span class="w">

</span><span class="c1">#Water: 11 for NLCD</span><span class="w">
</span><span class="n">df_subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">df_r_before_nlcd</span><span class="p">,</span><span class="n">nlcd_2006_RITA</span><span class="o">==</span><span class="m">22</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">df_subset</span><span class="o">$</span><span class="n">Green</span><span class="p">,</span><span class="w">
       </span><span class="n">df_subset</span><span class="o">$</span><span class="n">Red</span><span class="p">,</span><span class="w">
       </span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="w">
       </span><span class="n">cex</span><span class="o">=</span><span class="m">0.15</span><span class="p">)</span><span class="w">

</span><span class="n">title</span><span class="p">(</span><span class="s2">"Feature space Green-Red"</span><span class="p">)</span><span class="w">
</span><span class="n">names_vals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Evergreen Forest"</span><span class="p">,</span><span class="s2">"Developed High Intensity"</span><span class="p">,</span><span class="s2">"Water"</span><span class="p">)</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topright"</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="n">names_vals</span><span class="p">,</span><span class="w">
       </span><span class="n">pt.cex</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"green"</span><span class="p">,</span><span class="s2">"darkred"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">),</span><span class="w">
       </span><span class="n">pch</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="c1">#add circle symbol to line</span><span class="w">
       </span><span class="n">bty</span><span class="o">=</span><span class="s2">"n"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-10.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#### Feature space Red and NIR</span><span class="w">

</span><span class="c1">#Evergreen Forest:</span><span class="w">
</span><span class="n">df_subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">df_r_before_nlcd</span><span class="p">,</span><span class="n">nlcd_2006_RITA</span><span class="o">==</span><span class="m">42</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">df_subset</span><span class="o">$</span><span class="n">Red</span><span class="p">,</span><span class="w">
     </span><span class="n">df_subset</span><span class="o">$</span><span class="n">NIR</span><span class="p">,</span><span class="w">
     </span><span class="n">col</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span><span class="w">
     </span><span class="n">cex</span><span class="o">=</span><span class="m">0.15</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Red"</span><span class="p">,</span><span class="w">
     </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"NIR"</span><span class="p">)</span><span class="w">

</span><span class="c1">#Developed, High Intensity</span><span class="w">
</span><span class="n">df_subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">df_r_before_nlcd</span><span class="p">,</span><span class="n">nlcd_2006_RITA</span><span class="o">==</span><span class="m">22</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">df_subset</span><span class="o">$</span><span class="n">Red</span><span class="p">,</span><span class="w">
       </span><span class="n">df_subset</span><span class="o">$</span><span class="n">NIR</span><span class="p">,</span><span class="w">
       </span><span class="n">col</span><span class="o">=</span><span class="s2">"darkred"</span><span class="p">,</span><span class="w">
       </span><span class="n">cex</span><span class="o">=</span><span class="m">0.15</span><span class="p">)</span><span class="w">

</span><span class="c1">#Water</span><span class="w">
</span><span class="n">df_subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">df_r_before_nlcd</span><span class="p">,</span><span class="n">nlcd_2006_RITA</span><span class="o">==</span><span class="m">11</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">df_subset</span><span class="o">$</span><span class="n">Red</span><span class="p">,</span><span class="w">
       </span><span class="n">df_subset</span><span class="o">$</span><span class="n">NIR</span><span class="p">,</span><span class="w">
       </span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="w">
       </span><span class="n">cex</span><span class="o">=</span><span class="m">0.15</span><span class="p">)</span><span class="w">

</span><span class="n">title</span><span class="p">(</span><span class="s2">"Feature space Red-NIR"</span><span class="p">)</span><span class="w">
</span><span class="n">names_vals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Evergreen Forest"</span><span class="p">,</span><span class="s2">"Developed High Intensity"</span><span class="p">,</span><span class="s2">"Water"</span><span class="p">)</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topright"</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="n">names_vals</span><span class="p">,</span><span class="w">
       </span><span class="n">pt.cex</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"green"</span><span class="p">,</span><span class="s2">"darkred"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">),</span><span class="w">
       </span><span class="n">pch</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="c1">#add circle symbol to line</span><span class="w">
       </span><span class="n">bty</span><span class="o">=</span><span class="s2">"n"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-11.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#### Feature space Blue and Red</span><span class="w">

</span><span class="c1">#Water:</span><span class="w">
</span><span class="n">df_subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">df_r_before_nlcd</span><span class="p">,</span><span class="n">nlcd_2006_RITA</span><span class="o">==</span><span class="m">11</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">df_subset</span><span class="o">$</span><span class="n">Blue</span><span class="p">,</span><span class="w">
       </span><span class="n">df_subset</span><span class="o">$</span><span class="n">Red</span><span class="p">,</span><span class="w">
       </span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="w">
       </span><span class="n">cex</span><span class="o">=</span><span class="m">0.15</span><span class="p">,</span><span class="w">
       </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Blue"</span><span class="p">,</span><span class="w">
       </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Red"</span><span class="p">)</span><span class="w">

</span><span class="c1">#Evergreen Forest:</span><span class="w">
</span><span class="n">df_subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">df_r_before_nlcd</span><span class="p">,</span><span class="n">nlcd_2006_RITA</span><span class="o">==</span><span class="m">42</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">df_subset</span><span class="o">$</span><span class="n">Blue</span><span class="p">,</span><span class="w">
       </span><span class="n">df_subset</span><span class="o">$</span><span class="n">Red</span><span class="p">,</span><span class="w">
       </span><span class="n">col</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span><span class="w">
       </span><span class="n">cex</span><span class="o">=</span><span class="m">0.15</span><span class="p">)</span><span class="w">

</span><span class="c1">#Urban dense:</span><span class="w">
</span><span class="n">df_subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">df_r_before_nlcd</span><span class="p">,</span><span class="n">nlcd_2006_RITA</span><span class="o">==</span><span class="m">22</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">df_subset</span><span class="o">$</span><span class="n">Blue</span><span class="p">,</span><span class="w">
       </span><span class="n">df_subset</span><span class="o">$</span><span class="n">Red</span><span class="p">,</span><span class="w">
       </span><span class="n">col</span><span class="o">=</span><span class="s2">"darkred"</span><span class="p">,</span><span class="w">
       </span><span class="n">cex</span><span class="o">=</span><span class="m">0.15</span><span class="p">)</span><span class="w">

</span><span class="n">title</span><span class="p">(</span><span class="s2">"Feature space Blue-Red"</span><span class="p">)</span><span class="w">
</span><span class="n">names_vals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Evergreen Forest"</span><span class="p">,</span><span class="s2">"Developed High Intensity"</span><span class="p">,</span><span class="s2">"Water"</span><span class="p">)</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topright"</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="n">names_vals</span><span class="p">,</span><span class="w">
       </span><span class="n">pt.cex</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"green"</span><span class="p">,</span><span class="s2">"darkred"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">),</span><span class="w">
       </span><span class="n">pch</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="c1">#add circle symbol to line</span><span class="w">
       </span><span class="n">bty</span><span class="o">=</span><span class="s2">"n"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-12.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#### Generate Color composites</span><span class="w">
</span><span class="c1">### True color composite</span><span class="w">

</span><span class="n">plotRGB</span><span class="p">(</span><span class="n">r_before</span><span class="p">,</span><span class="w">
        </span><span class="n">r</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w">
        </span><span class="n">g</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w">
        </span><span class="n">b</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w">
        </span><span class="n">scale</span><span class="o">=</span><span class="m">0.6</span><span class="p">,</span><span class="w">
        </span><span class="n">stretch</span><span class="o">=</span><span class="s2">"hist"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-13.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">### False color composite:</span><span class="w">

</span><span class="n">plotRGB</span><span class="p">(</span><span class="n">r_before</span><span class="p">,</span><span class="w">
        </span><span class="n">r</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w">
        </span><span class="n">g</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w">
        </span><span class="n">b</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w">
        </span><span class="n">scale</span><span class="o">=</span><span class="m">0.6</span><span class="p">,</span><span class="w">
        </span><span class="n">stretch</span><span class="o">=</span><span class="s2">"hist"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-14.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plotRGB</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="w">
        </span><span class="n">r</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w">
        </span><span class="n">g</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w">
        </span><span class="n">b</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w">
        </span><span class="n">scale</span><span class="o">=</span><span class="m">0.6</span><span class="p">,</span><span class="w">
        </span><span class="n">stretch</span><span class="o">=</span><span class="s2">"hist"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-15.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">### Note the effect of flooding is particularly visible in the false color composites.</span><span class="w">
</span><span class="c1">### Let's examine different band combination to enhance features in the image, including flooded areas.</span><span class="w">

</span><span class="c1">###############################################</span><span class="w">
</span><span class="c1">##### PART III: Band combination: Indices and thresholding for flood mapping ##############</span><span class="w">

</span><span class="c1">### NIR experiment with threshold to  map water/flooding</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">r_before</span><span class="p">,</span><span class="s2">"NIR"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-16.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="s2">"NIR"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-17.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">### Lower NIR often correlates to areas with high water fraction or inundated:</span><span class="w">
</span><span class="n">r_rec_NIR_before</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">r_before</span><span class="p">,</span><span class="s2">"NIR"</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.2</span><span class="w">
</span><span class="n">r_rec_NIR_after</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="s2">"NIR"</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.2</span><span class="w">

</span><span class="c1">### THis is suggesting flooding!!!</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">r_rec_NIR_before</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s2">"Before RITA, NIR &gt; 0.2"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-18.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_rec_NIR_after</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s2">"After RITA, NIR &gt; 0.2"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-19.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#Compare to actual flooding data</span><span class="w">
</span><span class="n">freq_fema_zones</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">freq</span><span class="p">(</span><span class="n">r_ref</span><span class="p">))</span><span class="w">
</span><span class="n">xtab_threshold</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">crosstab</span><span class="p">(</span><span class="n">r_ref</span><span class="p">,</span><span class="n">r_rec_NIR_after</span><span class="p">,</span><span class="n">long</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">

</span><span class="c1">## % overlap between the flooded area and values below 0.2 in NIR</span><span class="w">
</span><span class="p">(</span><span class="n">xtab_threshold</span><span class="p">[</span><span class="m">5</span><span class="p">,</span><span class="m">3</span><span class="p">]</span><span class="o">/</span><span class="n">freq_fema_zones</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">])</span><span class="o">*</span><span class="m">100</span><span class="w"> </span><span class="c1">#agreement with FEMA flooded area in %.</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 76.17498
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">############## Generating indices based on raster algebra of original bands</span><span class="w">
</span><span class="c1">## Let's generate a series of indices, we list a few possibility from the literature.</span><span class="w">
</span><span class="c1">#1) NDVI = (NIR - Red)/(NIR+Red)</span><span class="w">
</span><span class="c1">#2) NDWI = (Green - NIR)/(Green + NIR)</span><span class="w">
</span><span class="c1">#3) MNDWI = Green - SWIR2 / Green + SWIR2</span><span class="w">
</span><span class="c1">#4) NDWI2 (LSWIB5) =  (NIR - SWIR1)/(NIR + SWIR1)</span><span class="w">
</span><span class="c1">#5) LSWI (LSWIB5) =  (NIR - SWIR2)/(NIR + SWIR2)</span><span class="w">

</span><span class="nf">names</span><span class="p">(</span><span class="n">r_before</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Red"   "NIR"   "Blue"  "Green" "SWIR1" "SWIR2" "SWIR3"
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">r_before_NDVI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">r_before</span><span class="o">$</span><span class="n">NIR</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">Red</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">r_before</span><span class="o">$</span><span class="n">NIR</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">Red</span><span class="p">)</span><span class="w">
</span><span class="n">r_after_NDVI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="s2">"NIR"</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="s2">"Red"</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="s2">"NIR"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="s2">"Red"</span><span class="p">))</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="n">r_before_NDVI</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="n">matlab.like</span><span class="p">(</span><span class="m">255</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-20.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_after_NDVI</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="n">matlab.like2</span><span class="p">(</span><span class="m">255</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-21.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">### Experiment with different threshold values:</span><span class="w">
</span><span class="c1"># THis is suggesting flooding!!!</span><span class="w">

</span><span class="n">histogram</span><span class="p">(</span><span class="n">r_before_NDVI</span><span class="p">)</span><span class="w"> </span><span class="c1"># Examine histogram to look for potential threshold values</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-22.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">histogram</span><span class="p">(</span><span class="n">r_after_NDVI</span><span class="p">)</span><span class="w"> </span><span class="c1"># Examine histogram to look for poential threshold values</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-23.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_before_NDVI</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">-0.5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-24.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_after_NDVI</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">-0.5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-25.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_before_NDVI</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">-0.1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-26.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_after_NDVI</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">-0.1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-27.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#2) NDWI = (Green - NIR)/(Green + NIR)</span><span class="w">
</span><span class="c1">#3) MNDWI = Green - SWIR2 / Green + SWIR2</span><span class="w">

</span><span class="c1">#Modified NDWI known as MNDWI : Green - SWIR2/(Green + SWIR2)</span><span class="w">

</span><span class="c1">#According to Gao (1996), NDWI is a good indicator for vegetation liquid water content and </span><span class="w">
</span><span class="c1"># is less sensitive to atmospheric scattering effects than NDVI. In some studies, MODIS band 6 </span><span class="w">
</span><span class="c1"># is used for the NDWI calculation, because it is sensitive to water types and contents </span><span class="w">
</span><span class="c1"># (Li et al., 2011), while band 5 is sensitive to vegetation liquid water content (Gao, 1996).</span><span class="w">

</span><span class="n">r_before_MNDWI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">r_before</span><span class="o">$</span><span class="n">Green</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">SWIR2</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">r_before</span><span class="o">$</span><span class="n">Green</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">SWIR2</span><span class="p">)</span><span class="w">
</span><span class="n">r_after_MNDWI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">r_after</span><span class="o">$</span><span class="n">Green</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r_after</span><span class="o">$</span><span class="n">SWIR2</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">r_after</span><span class="o">$</span><span class="n">Green</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r_after</span><span class="o">$</span><span class="n">SWIR2</span><span class="p">)</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="n">r_before_MNDWI</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="n">rev</span><span class="p">(</span><span class="n">matlab.like</span><span class="p">(</span><span class="m">255</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-28.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_after_MNDWI</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="n">rev</span><span class="p">(</span><span class="n">matlab.like</span><span class="p">(</span><span class="m">255</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-29.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">### THis is suggesting flooding!!!</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">r_before_MNDWI</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-30.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_after_MNDWI</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-31.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_before_MNDWI</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-32.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_after_MNDWI</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-33.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">r_diff_MNDWI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">r_after_MNDWI</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r_before_MNDWI</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">r_diff_MNDWI</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-34.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_diff_MNDWI</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w"> </span><span class="c1">## Increase in MNDWI: Areas that may have become flooded</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-35.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#Standardize image:</span><span class="w">
</span><span class="n">mean_val</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cellStats</span><span class="p">(</span><span class="n">r_diff_MNDWI</span><span class="p">,</span><span class="s2">"mean"</span><span class="p">)</span><span class="w">
</span><span class="n">sd_val</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cellStats</span><span class="p">(</span><span class="n">r_diff_MNDWI</span><span class="p">,</span><span class="s2">"sd"</span><span class="p">)</span><span class="w">

</span><span class="n">r_diff_std</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">r_diff_MNDWI</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean_val</span><span class="p">)</span><span class="o">/</span><span class="w"> </span><span class="n">sd_val</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">r_diff_std</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-36.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">histogram</span><span class="p">(</span><span class="n">r_diff_std</span><span class="p">)</span><span class="w"> 
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-37.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_diff_std</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="c1">## increase in MNDWI 2 standard deiation away</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-38.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_diff_std</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="c1">## increase in MNDWI 2 standard deiation away</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-39.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">### Generate a map of flooding with MNDWI and compare to FEMA map:</span><span class="w">

</span><span class="n">r_after_flood</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">r_diff_std</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="w"> 
</span><span class="n">plot</span><span class="p">(</span><span class="n">r_after_flood</span><span class="p">)</span><span class="w">

</span><span class="c1">#reclass in zero/1!!!</span><span class="w">

</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">v</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">r_ref_rec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subs</span><span class="p">(</span><span class="n">r_ref</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">r_ref_rec</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-40.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">xtab_tb</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">crosstab</span><span class="p">(</span><span class="n">r_after_flood</span><span class="p">,</span><span class="n">r_ref_rec</span><span class="p">)</span><span class="w">

</span><span class="c1">## Examine overlap between flooded area and FEMA:</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="n">r_after_flood</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-41.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">r_overlap</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">r_ref_rec</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r_after_flood</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">r_overlap</span><span class="p">)</span><span class="w"> </span><span class="c1">## Flood map area of aggreement with FEMA</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-42.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">###############################################</span><span class="w">
</span><span class="c1">##### PART IV: Principal Component Analysis and band transformation</span><span class="w">
</span><span class="c1">## Another avenue to combine original bands into indices is to use linear transformation.</span><span class="w">
</span><span class="c1">## We examine Principal Component Analysis and the Tassel Cap Transform.</span><span class="w">

</span><span class="c1">#Correlate long term mean to PC!</span><span class="w">
</span><span class="n">cor_mat_layerstats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">layerStats</span><span class="p">(</span><span class="n">r_before</span><span class="p">,</span><span class="w"> </span><span class="s1">'pearson'</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">cor_matrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cor_mat_layerstats</span><span class="o">$</span><span class="n">`pearson correlation coefficient`</span><span class="w">
</span><span class="nf">class</span><span class="p">(</span><span class="n">cor_matrix</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "matrix"
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">print</span><span class="p">(</span><span class="n">cor_matrix</span><span class="p">)</span><span class="w"> </span><span class="c1">#note size is 7x7</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            Red       NIR         Blue     Green        SWIR1     SWIR2
Red   1.0000000 0.2398870  0.903113075 0.9707865  0.256771113 0.4605483
NIR   0.2398870 1.0000000  0.013412596 0.2318272  0.978567657 0.8911699
Blue  0.9031131 0.0134126  1.000000000 0.9498225 -0.002725252 0.1571903
Green 0.9707865 0.2318272  0.949822516 1.0000000  0.218488306 0.3842003
SWIR1 0.2567711 0.9785677 -0.002725252 0.2184883  1.000000000 0.9474207
SWIR2 0.4605483 0.8911699  0.157190340 0.3842003  0.947420706 1.0000000
SWIR3 0.6443259 0.7292226  0.343071136 0.5438923  0.805069686 0.9448527
          SWIR3
Red   0.6443259
NIR   0.7292226
Blue  0.3430711
Green 0.5438923
SWIR1 0.8050697
SWIR2 0.9448527
SWIR3 1.0000000
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">pca_mod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">principal</span><span class="p">(</span><span class="n">cor_matrix</span><span class="p">,</span><span class="n">nfactors</span><span class="o">=</span><span class="m">7</span><span class="p">,</span><span class="n">rotate</span><span class="o">=</span><span class="s2">"none"</span><span class="p">)</span><span class="w">
</span><span class="nf">class</span><span class="p">(</span><span class="n">pca_mod</span><span class="o">$</span><span class="n">loadings</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "loadings"
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">print</span><span class="p">(</span><span class="n">pca_mod</span><span class="o">$</span><span class="n">loadings</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Loadings:
      PC1    PC2    PC3    PC4    PC5    PC6    PC7   
Red    0.774  0.616                                   
NIR    0.779 -0.556  0.282                            
Blue   0.551  0.812  0.140  0.131                     
Green  0.734  0.665  0.101                            
SWIR1  0.806 -0.576  0.123                            
SWIR2  0.905 -0.403 -0.121                            
SWIR3  0.933 -0.162 -0.315                            

                 PC1   PC2   PC3   PC4   PC5   PC6   PC7
SS loadings    4.387 2.310 0.246 0.034 0.011 0.010 0.003
Proportion Var 0.627 0.330 0.035 0.005 0.002 0.001 0.000
Cumulative Var 0.627 0.957 0.992 0.997 0.998 1.000 1.000
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">pca_mod</span><span class="o">$</span><span class="n">loadings</span><span class="p">[,</span><span class="m">1</span><span class="p">][</span><span class="n">band_refl_order</span><span class="p">],</span><span class="n">type</span><span class="o">=</span><span class="s2">"b"</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"time steps"</span><span class="p">,</span><span class="w">
     </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"PC loadings"</span><span class="p">,</span><span class="w">
     </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w">
     </span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="m">-1</span><span class="o">*</span><span class="p">(</span><span class="n">pca_mod</span><span class="o">$</span><span class="n">loadings</span><span class="p">[,</span><span class="m">2</span><span class="p">][</span><span class="n">band_refl_order</span><span class="p">]),</span><span class="n">type</span><span class="o">=</span><span class="s2">"b"</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="n">pca_mod</span><span class="o">$</span><span class="n">loadings</span><span class="p">[,</span><span class="m">3</span><span class="p">][</span><span class="n">band_refl_order</span><span class="p">],</span><span class="n">type</span><span class="o">=</span><span class="s2">"b"</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span><span class="w">
</span><span class="n">title</span><span class="p">(</span><span class="s2">"Loadings for the first three components using T-mode"</span><span class="p">)</span><span class="w">

</span><span class="c1">##Make this a time series</span><span class="w">
</span><span class="n">loadings_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">pca_mod</span><span class="o">$</span><span class="n">loadings</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">7</span><span class="p">])</span><span class="w">
</span><span class="n">title</span><span class="p">(</span><span class="s2">"Loadings for the first three components using T-mode"</span><span class="p">)</span><span class="w">
</span><span class="n">names_vals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"pc1"</span><span class="p">,</span><span class="s2">"pc2"</span><span class="p">,</span><span class="s2">"pc3"</span><span class="p">)</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topright"</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="n">names_vals</span><span class="p">,</span><span class="w">
       </span><span class="n">pt.cex</span><span class="o">=</span><span class="m">0.8</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">1.1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"blue"</span><span class="p">,</span><span class="s2">"red"</span><span class="p">,</span><span class="s2">"black"</span><span class="p">),</span><span class="w">
       </span><span class="n">lty</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="c1"># set legend symbol as lines</span><span class="w">
       </span><span class="n">pch</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="c1">#add circle symbol to line</span><span class="w">
       </span><span class="n">lwd</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="n">bty</span><span class="o">=</span><span class="s2">"n"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-43.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">## Add scree plot</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">pca_mod</span><span class="o">$</span><span class="n">values</span><span class="p">,</span><span class="n">main</span><span class="o">=</span><span class="s2">"Scree plot: Variance explained"</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s2">"b"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-44.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">### Generate scores from eigenvectors</span><span class="w">
</span><span class="c1">### Using predict function: this is recommended for raster.</span><span class="w">
</span><span class="n">r_pca</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">r_before</span><span class="p">,</span><span class="w"> </span><span class="n">pca_mod</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">7</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s2">"pc_scores.tif"</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w"> </span><span class="c1"># fast</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">r_pca</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-45.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_pca</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-46.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_pca</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-47.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">r_pca</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="n">subset</span><span class="p">(</span><span class="n">r_pca</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-48.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">r_pca</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="n">subset</span><span class="p">(</span><span class="n">r_pca</span><span class="p">,</span><span class="m">3</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-49.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#### Generate a plot for PCA with loadings and compare to Tassel Cap</span><span class="w">

</span><span class="n">var_labels</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">loadings_df</span><span class="p">)</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="n">loadings_df</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="n">loadings_df</span><span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="w">
     </span><span class="n">type</span><span class="o">=</span><span class="s2">"p"</span><span class="p">,</span><span class="w">
     </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w">
     </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="o">=</span><span class="nf">names</span><span class="p">(</span><span class="n">loadings_df</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="w">
     </span><span class="n">ylab</span><span class="o">=</span><span class="nf">names</span><span class="p">(</span><span class="n">loadings_df</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="w">
     </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w">
     </span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w">
     </span><span class="n">axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
     </span><span class="n">cex.lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.2</span><span class="p">)</span><span class="w">
</span><span class="n">axis</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">at</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0.2</span><span class="p">),</span><span class="n">cex</span><span class="o">=</span><span class="m">1.2</span><span class="p">)</span><span class="w">
</span><span class="n">axis</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">las</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">at</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0.2</span><span class="p">),</span><span class="n">cex</span><span class="o">=</span><span class="m">1.2</span><span class="p">)</span><span class="w"> </span><span class="c1"># "1' for side=below, the axis is drawned  on the right at location 0 and 1</span><span class="w">

</span><span class="n">box</span><span class="p">()</span><span class="w">    </span><span class="c1">#This draws a box...</span><span class="w">

</span><span class="n">title</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Loadings for component "</span><span class="p">,</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">loadings_df</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="s2">" and "</span><span class="w"> </span><span class="p">,</span><span class="nf">names</span><span class="p">(</span><span class="n">loadings_df</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="p">))</span><span class="w">
</span><span class="n">draw.circle</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="m">1.0</span><span class="p">,</span><span class="m">1.0</span><span class="p">),</span><span class="n">nv</span><span class="o">=</span><span class="m">500</span><span class="p">)</span><span class="c1">#,border="purple",</span><span class="w">
</span><span class="n">text</span><span class="p">(</span><span class="n">loadings_df</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="n">loadings_df</span><span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="n">var_labels</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">            
</span><span class="n">grid</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-50.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">##### plot feature space:</span><span class="w">

</span><span class="n">df_raster_val</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">stack</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="n">r_pca</span><span class="p">,</span><span class="n">nlcd2006_reg</span><span class="p">))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">df_raster_val</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>         Red       NIR       Blue      Green     SWIR1     SWIR2
1 0.04558113 0.3027903 0.02379627 0.05476730 0.3318335 0.1902746
2 0.04460510 0.3043112 0.02354558 0.05586702 0.3138186 0.1842244
3 0.04348749 0.2998908 0.02374887 0.05381133 0.3123330 0.1855501
4 0.04507260 0.3017146 0.02426019 0.05503851 0.3193893 0.1913280
5 0.04715690 0.3239896 0.02511090 0.05962222 0.3417773 0.1930779
6 0.03485106 0.2683164 0.01941371 0.04450204 0.2855803 0.1609111
       SWIR3 pc_scores.1 pc_scores.2 pc_scores.3 pc_scores.4 pc_scores.5
1 0.07314926  -0.7644424  -0.1749840   0.4895376  -0.3940996  -0.7156922
2 0.06792310  -0.9065449  -0.3173643   0.9340215  -1.2679656  -3.0844703
3 0.07248760  -0.7900366  -0.5316336   1.2609810  -0.8686562  -2.8946190
4 0.07654412  -0.7877789  -0.5503042   1.1144350  -0.9439425  -2.8750505
5 0.07032830  -0.3890644  -0.3253821   0.6932408  -0.6264383  -1.0684590
6 0.05962812  -0.6346722  -0.3010963   0.9234368  -0.6627523  -2.1239798
  pc_scores.6 pc_scores.7 nlcd_2006_RITA
1   0.9251045  1.48893476             NA
2   1.4692621  0.02715476             NA
3   1.9787420 -0.02099684             NA
4   1.8841606 -0.05822323             NA
5   1.0431399  0.46276042             NA
6   1.4554931  0.37810266             NA
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#Water</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">df_raster_val</span><span class="p">[</span><span class="n">df_raster_val</span><span class="o">$</span><span class="n">nlcd_2006_RITA</span><span class="o">==</span><span class="m">11</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"pc_scores.1"</span><span class="p">)],</span><span class="w">
     </span><span class="n">df_raster_val</span><span class="p">[</span><span class="n">df_raster_val</span><span class="o">$</span><span class="n">nlcd_2006_RITA</span><span class="o">==</span><span class="m">11</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"pc_scores.2"</span><span class="p">)],</span><span class="w">
     </span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">0.15</span><span class="p">,</span><span class="w">
     </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-2</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w">
     </span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">

</span><span class="c1">#Urban: dense</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">df_raster_val</span><span class="p">[</span><span class="n">df_raster_val</span><span class="o">$</span><span class="n">nlcd_2006_RITA</span><span class="o">==</span><span class="m">22</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"pc_scores.1"</span><span class="p">)],</span><span class="w">
       </span><span class="n">df_raster_val</span><span class="p">[</span><span class="n">df_raster_val</span><span class="o">$</span><span class="n">nlcd_2006_RITA</span><span class="o">==</span><span class="m">22</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"pc_scores.2"</span><span class="p">)],</span><span class="w">
       </span><span class="n">col</span><span class="o">=</span><span class="s2">"brown"</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">0.15</span><span class="p">)</span><span class="w">

</span><span class="c1">#Forest:</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">df_raster_val</span><span class="p">[</span><span class="n">df_raster_val</span><span class="o">$</span><span class="n">nlcd_2006_RITA</span><span class="o">==</span><span class="m">42</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"pc_scores.1"</span><span class="p">)],</span><span class="w">
       </span><span class="n">df_raster_val</span><span class="p">[</span><span class="n">df_raster_val</span><span class="o">$</span><span class="n">nlcd_2006_RITA</span><span class="o">==</span><span class="m">42</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"pc_scores.2"</span><span class="p">)],</span><span class="w">
       </span><span class="n">col</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">0.15</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-51.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">### Note the negative values are related to Forest and positve to water on PC2</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">r_pca</span><span class="o">$</span><span class="n">pc_scores.2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w"> </span><span class="c1">#water related?</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-52.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_pca</span><span class="o">$</span><span class="n">pc_scores.2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w"> </span><span class="c1">#vegetation related?</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-53.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#### Examine relationship with Tasselcap transform adapted for MODIS:</span><span class="w">
</span><span class="c1">#6) TCWI =  0.10839 * Red+ 0.0912 * NIR +0.5065 * Blue+ 0.404 * Green </span><span class="w">
</span><span class="c1">#            - 0.241 * SWIR1- 0.4658 * SWIR2-</span><span class="w">
</span><span class="c1">#           0.5306 * SWIR3</span><span class="w">
</span><span class="c1">#7) TCBI = 0.3956 * Red + 0.4718 * NIR +0.3354 * Blue+ 0.3834 * Green</span><span class="w">
</span><span class="c1">#           + 0.3946 * SWIR1 + 0.3434 * SWIR2+ 0.2964 * SWIR3</span><span class="w">

</span><span class="n">r_TCWI</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="m">0.10839</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">Red</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.0912</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">NIR</span><span class="w"> </span><span class="m">+0.5065</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">Blue</span><span class="o">+</span><span class="w"> </span><span class="m">0.404</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">Green</span><span class="w"> 
</span><span class="o">-</span><span class="w"> </span><span class="m">0.241</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">SWIR1</span><span class="o">-</span><span class="w"> </span><span class="m">0.4658</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">SWIR2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">0.5306</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">SWIR3</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class       : RasterLayer 
dimensions  : 116, 298, 34568  (nrow, ncol, ncell)
resolution  : 926.6254, 926.6254  (x, y)
extent      : 1585224, 1861359, 842226.7, 949715.2  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=lcc +lat_1=27.41666666666667 +lat_2=34.91666666666666 +lat_0=31.16666666666667 +lon_0=-100 +x_0=1000000 +y_0=1000000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
data source : in memory
names       : layer 
values      : -0.5969822, -0.00232494  (min, max)
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">r_TCBI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.3956</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">Red</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.4718</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">NIR</span><span class="w"> </span><span class="m">+0.3354</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">Blue</span><span class="o">+</span><span class="w"> </span><span class="m">0.3834</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">Green</span><span class="w">
          </span><span class="o">+</span><span class="w"> </span><span class="m">0.3946</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">SWIR1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.3434</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">SWIR2</span><span class="o">+</span><span class="w"> </span><span class="m">0.2964</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r_before</span><span class="o">$</span><span class="n">SWIR3</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class       : RasterLayer 
dimensions  : 116, 298, 34568  (nrow, ncol, ncell)
resolution  : 926.6254, 926.6254  (x, y)
extent      : 1585224, 1861359, 842226.7, 949715.2  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=lcc +lat_1=27.41666666666667 +lat_2=34.91666666666666 +lat_0=31.16666666666667 +lon_0=-100 +x_0=1000000 +y_0=1000000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
data source : in memory
names       : layer 
values      : 0.00172096, 0.4989139  (min, max)
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#r_TCWI &lt;- r_TCWI*10</span><span class="w">
</span><span class="n">histogram</span><span class="p">(</span><span class="n">r_TCWI</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-54.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_TCWI</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-55.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_TCWI</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0.2</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-56.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_TCWI</span><span class="o">&gt;</span><span class="m">0.1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-57.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">histogram</span><span class="p">(</span><span class="n">r_TCBI</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-58.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_TCBI</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-59.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_TCBI</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0.2</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-60.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="n">r_stack</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stack</span><span class="p">(</span><span class="n">r_TCWI</span><span class="p">,</span><span class="n">r_TCBI</span><span class="p">,</span><span class="w"> </span><span class="n">r_pca</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">r_stack</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"TCWI"</span><span class="p">,</span><span class="s2">"TCBI"</span><span class="p">,</span><span class="nf">names</span><span class="p">(</span><span class="n">r_pca</span><span class="p">))</span><span class="w">
</span><span class="n">cor_r_TC</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">layerStats</span><span class="p">(</span><span class="n">r_stack</span><span class="p">,</span><span class="s2">"pearson"</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">cor_r_TC</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">cor_r_TC</span><span class="o">$</span><span class="n">`pearson correlation coefficient`</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">cor_r_TC</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                  TCWI         TCBI pc_scores.1  pc_scores.2 pc_scores.3
TCWI        1.00000000 0.8283253068  0.83971868  0.548005396  0.26578247
TCBI        0.82832531 1.0000000000  0.87114254  0.106891136  0.28142299
pc_scores.1 0.83971868 0.8711425415  1.00000000  0.082280569  0.13336455
pc_scores.2 0.54800540 0.1068911362  0.08228057  1.000000000  0.02282614
pc_scores.3 0.26578247 0.2814229943  0.13336455  0.022826135  1.00000000
pc_scores.4 0.13531034 0.1067056440  0.25180545 -0.008046805 -0.26120385
pc_scores.5 0.06877618 0.0001461868  0.14499957  0.078513273 -0.28695036
pc_scores.6 0.14641088 0.1400215251  0.06428065  0.070531136  0.32528627
pc_scores.7 0.03469429 0.0428780431  0.11454351 -0.114043686  0.03411671
             pc_scores.4   pc_scores.5 pc_scores.6 pc_scores.7
TCWI         0.135310342  0.0687761767  0.14641088  0.03469429
TCBI         0.106705644  0.0001461868  0.14002153  0.04287804
pc_scores.1  0.251805447  0.1449995703  0.06428065  0.11454351
pc_scores.2 -0.008046805  0.0785132730  0.07053114 -0.11404369
pc_scores.3 -0.261203854 -0.2869503646  0.32528627  0.03411671
pc_scores.4  1.000000000  0.2583954010 -0.18593196  0.12719391
pc_scores.5  0.258395401  1.0000000000 -0.31388314  0.35960982
pc_scores.6 -0.185931965 -0.3138831416  1.00000000  0.05074089
pc_scores.7  0.127193911  0.3596098185  0.05074089  1.00000000
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">##### Plot on the loading space using TCBI and TCWI as supplementary variables</span><span class="w">
</span><span class="n">var_labels</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">loadings_df</span><span class="p">)</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="n">loadings_df</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="n">loadings_df</span><span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="w">
     </span><span class="n">type</span><span class="o">=</span><span class="s2">"p"</span><span class="p">,</span><span class="w">
     </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w">
     </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="o">=</span><span class="nf">names</span><span class="p">(</span><span class="n">loadings_df</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="w">
     </span><span class="n">ylab</span><span class="o">=</span><span class="nf">names</span><span class="p">(</span><span class="n">loadings_df</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="w">
     </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w">
     </span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w">
     </span><span class="n">axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
     </span><span class="n">cex.lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.2</span><span class="p">)</span><span class="w">

</span><span class="n">points</span><span class="p">(</span><span class="n">cor_r_TC</span><span class="o">$</span><span class="n">pc_scores.1</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="n">cor_r_TC</span><span class="o">$</span><span class="n">pc_scores.2</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">cor_r_TC</span><span class="o">$</span><span class="n">pc_scores.1</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="n">cor_r_TC</span><span class="o">$</span><span class="n">pc_scores.2</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="n">col</span><span class="o">=</span><span class="s2">"green"</span><span class="p">)</span><span class="w">

</span><span class="n">axis</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">at</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0.2</span><span class="p">),</span><span class="n">cex</span><span class="o">=</span><span class="m">1.2</span><span class="p">)</span><span class="w">
</span><span class="n">axis</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">las</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">at</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0.2</span><span class="p">),</span><span class="n">cex</span><span class="o">=</span><span class="m">1.2</span><span class="p">)</span><span class="w"> </span><span class="c1"># "1' for side=below, the axis is drawned  on the right at location 0 and 1</span><span class="w">
</span><span class="n">box</span><span class="p">()</span><span class="w">    </span><span class="c1">#This draws a box...</span><span class="w">

</span><span class="n">title</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Loadings for component "</span><span class="p">,</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">loadings_df</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="s2">" and "</span><span class="w"> </span><span class="p">,</span><span class="nf">names</span><span class="p">(</span><span class="n">loadings_df</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="p">))</span><span class="w">
</span><span class="n">draw.circle</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="m">1.0</span><span class="p">,</span><span class="m">1.0</span><span class="p">),</span><span class="n">nv</span><span class="o">=</span><span class="m">500</span><span class="p">)</span><span class="c1">#,border="purple",</span><span class="w">
</span><span class="n">text</span><span class="p">(</span><span class="n">loadings_df</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="n">loadings_df</span><span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="n">var_labels</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">            
</span><span class="n">text</span><span class="p">(</span><span class="n">cor_r_TC</span><span class="o">$</span><span class="n">pc_scores.1</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="n">cor_r_TC</span><span class="o">$</span><span class="n">pc_scores.2</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="s2">"TCWI"</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">text</span><span class="p">(</span><span class="n">cor_r_TC</span><span class="o">$</span><span class="n">pc_scores.1</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="n">cor_r_TC</span><span class="o">$</span><span class="n">pc_scores.2</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="s2">"TCBI"</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">grid</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part1/unnamed-chunk-1-61.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-1.R"><div class="highlight"><pre class="highlight"><code><span class="c1">########################## End of Script ###################################</span><span class="w">
</span></code></pre></div></div>

<p class="ToS"><a href="#/slides/part1">Top of Section</a></p>

<hr />

<p><a name="/slides/part2"></a></p>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="c1">####################################    Flood Mapping Analyses   #######################################</span><span class="w">
</span><span class="c1">############################  Analyze and map flooding from RITA hurricane  #######################################</span><span class="w">
</span><span class="c1">#This script performs analyses for the Exercise 6 of the Short Course using reflectance data derived from MODIS.</span><span class="w">
</span><span class="c1">#The goal is to map flooding from RITA using various reflectance bands from Remote Sensing platforms.</span><span class="w">
</span><span class="c1">#Additional data is provided including FEMA flood region. </span><span class="w">
</span><span class="c1">#</span><span class="w">
</span><span class="c1">#AUTHORS: Benoit Parmentier                                             </span><span class="w">
</span><span class="c1">#DATE CREATED: 03/13/2018 </span><span class="w">
</span><span class="c1">#DATE MODIFIED: 04/01/2018</span><span class="w">
</span><span class="c1">#Version: 1</span><span class="w">
</span><span class="c1">#PROJECT: SESYNC and AAG 2018 workshop/Short Course preparation</span><span class="w">
</span><span class="c1">#TO DO:</span><span class="w">
</span><span class="c1">#</span><span class="w">
</span><span class="c1">#COMMIT: setting up input data</span><span class="w">
</span><span class="c1">#</span><span class="w">
</span><span class="c1">#################################################################################################</span><span class="w">

</span><span class="c1">###Loading R library and packages                                                      </span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span><span class="w"> </span><span class="c1"># spatial/geographfic objects and functions</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rgdal</span><span class="p">)</span><span class="w"> </span><span class="c1">#GDAL/OGR binding for R with functionalities</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">spdep</span><span class="p">)</span><span class="w"> </span><span class="c1">#spatial analyses operations, functions etc.</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">gtools</span><span class="p">)</span><span class="w"> </span><span class="c1"># contains mixsort and other useful functions</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">maptools</span><span class="p">)</span><span class="w"> </span><span class="c1"># tools to manipulate spatial data</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">parallel</span><span class="p">)</span><span class="w"> </span><span class="c1"># parallel computation, part of base package no</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rasterVis</span><span class="p">)</span><span class="w"> </span><span class="c1"># raster visualization operations</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span><span class="w"> </span><span class="c1"># raster functionalities</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">forecast</span><span class="p">)</span><span class="w"> </span><span class="c1">#ARIMA forecasting</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">xts</span><span class="p">)</span><span class="w"> </span><span class="c1">#extension for time series object and analyses</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">zoo</span><span class="p">)</span><span class="w"> </span><span class="c1"># time series object and analysis</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span><span class="w"> </span><span class="c1"># dates functionality</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">colorRamps</span><span class="p">)</span><span class="w"> </span><span class="c1">#contains matlab.like color palette</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rgeos</span><span class="p">)</span><span class="w"> </span><span class="c1">#contains topological operations</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">sphet</span><span class="p">)</span><span class="w"> </span><span class="c1">#contains spreg, spatial regression modeling</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">BMS</span><span class="p">)</span><span class="w"> </span><span class="c1">#contains hex2bin and bin2hex, Bayesian methods</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">bitops</span><span class="p">)</span><span class="w"> </span><span class="c1"># function for bitwise operations</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">foreign</span><span class="p">)</span><span class="w"> </span><span class="c1"># import datasets from SAS, spss, stata and other sources</span><span class="w">
</span><span class="c1">#library(gdata) #read xls, dbf etc., not recently updated but useful</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">classInt</span><span class="p">)</span><span class="w"> </span><span class="c1">#methods to generate class limits</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="w"> </span><span class="c1">#data wrangling: various operations for splitting, combining data</span><span class="w">
</span><span class="c1">#library(gstat) #spatial interpolation and kriging methods</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">readxl</span><span class="p">)</span><span class="w"> </span><span class="c1">#functionalities to read in excel type data</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">psych</span><span class="p">)</span><span class="w"> </span><span class="c1">#pca/eigenvector decomposition functionalities</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">plotrix</span><span class="p">)</span><span class="w"> </span><span class="c1">#various graphic functions e.g. draw.circle</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">nnet</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rpart</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">e</span><span class="m">1071</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Attaching package: 'e1071'
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following object is masked from 'package:raster':

    interpolate
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following object is masked from 'package:gtools':

    permutations
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">caret</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Loading required package: ggplot2
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Attaching package: 'ggplot2'
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following objects are masked from 'package:psych':

    %+%, alpha
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following object is masked from 'package:forecast':

    autolayer
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following object is masked from 'package:latticeExtra':

    layer
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following object is masked from 'package:raster':

    calc
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="c1">###### Functions used in this script</span><span class="w">

</span><span class="n">create_dir_fun</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">outDir</span><span class="p">,</span><span class="n">out_suffix</span><span class="o">=</span><span class="kc">NULL</span><span class="p">){</span><span class="w">
  </span><span class="c1">#if out_suffix is not null then append out_suffix string</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">out_suffix</span><span class="p">)){</span><span class="w">
    </span><span class="n">out_name</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"output_"</span><span class="p">,</span><span class="n">out_suffix</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w">
    </span><span class="n">outDir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="n">outDir</span><span class="p">,</span><span class="n">out_name</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="c1">#create if does not exists</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">file.exists</span><span class="p">(</span><span class="n">outDir</span><span class="p">)){</span><span class="w">
    </span><span class="n">dir.create</span><span class="p">(</span><span class="n">outDir</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">outDir</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1">#Used to load RData object saved within the functions produced.</span><span class="w">
</span><span class="n">load_obj</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">f</span><span class="p">){</span><span class="w">
  </span><span class="n">env</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">new.env</span><span class="p">()</span><span class="w">
  </span><span class="n">nm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">env</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w">
  </span><span class="n">env</span><span class="p">[[</span><span class="n">nm</span><span class="p">]]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1">#####  Parameters and argument set up ###########</span><span class="w">

</span><span class="n">in_dir_var</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"../data"</span><span class="w">
</span><span class="n">out_dir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"."</span><span class="w">

</span><span class="c1">#region coordinate reference system</span><span class="w">
</span><span class="c1">#http://spatialreference.org/ref/epsg/nad83-texas-state-mapping-system/proj4/</span><span class="w">
</span><span class="n">CRS_reg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"+proj=lcc +lat_1=27.41666666666667 +lat_2=34.91666666666666 +lat_0=31.16666666666667 +lon_0=-100 +x_0=1000000 +y_0=1000000 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"</span><span class="w"> 
</span><span class="n">file_format</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">".tif"</span><span class="w"> </span><span class="c1">#PARAM5</span><span class="w">
</span><span class="n">NA_flag_val</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">-9999</span><span class="w"> </span><span class="c1">#PARAM6</span><span class="w">
</span><span class="n">out_suffix</span><span class="w"> </span><span class="o">&lt;-</span><span class="s2">"exercise6_03312018"</span><span class="w"> </span><span class="c1">#output suffix for the files and ouptu folder #PARAM 8</span><span class="w">
</span><span class="n">create_out_dir_param</span><span class="o">=</span><span class="kc">TRUE</span><span class="w"> </span><span class="c1">#PARAM9</span><span class="w">

</span><span class="c1">#ARG9</span><span class="w">
</span><span class="c1">#local raster name defining resolution, extent</span><span class="w">
</span><span class="n">infile_RITA_reflectance_date2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"mosaiced_MOD09A1_A2005273__006_reflectance_masked_RITA_reg_1km.tif"</span><span class="w">
</span><span class="n">infile_reg_outline</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"new_strata_rita_10282017"</span><span class="w"> </span><span class="c1"># Region outline and FEMA zones</span><span class="w">
</span><span class="n">infile_modis_bands_information</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"df_modis_band_info.txt"</span><span class="w"> </span><span class="c1"># MOD09 bands information.</span><span class="w">
</span><span class="n">nlcd_2006_filename</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"nlcd_2006_RITA.tif"</span><span class="w"> </span><span class="c1"># NLCD2006 Land cover data aggregated at ~ 1km.</span><span class="w">

</span><span class="c1">###########################  START SCRIPT  ##############################</span><span class="w">

</span><span class="c1">####### SET UP OUTPUT DIRECTORY #######</span><span class="w">

</span><span class="c1">## First create an output directory</span><span class="w">

</span><span class="k">if</span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)){</span><span class="w">
  </span><span class="n">out_dir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dirname</span><span class="p">(</span><span class="n">in_dir</span><span class="p">)</span><span class="w"> </span><span class="c1">#output will be created in the input dir</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">out_suffix_s</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">out_suffix</span><span class="w"> </span><span class="c1">#can modify name of output suffix</span><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="n">create_out_dir_param</span><span class="o">==</span><span class="kc">TRUE</span><span class="p">){</span><span class="w">
  </span><span class="n">out_dir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">create_dir_fun</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span><span class="n">out_suffix_s</span><span class="p">)</span><span class="w">
  </span><span class="n">setwd</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="w">
  </span><span class="n">setwd</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span><span class="w"> </span><span class="c1">#use previoulsy defined directory</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1">#####################################</span><span class="w">
</span><span class="c1">##### PART I: DISPLAY AND EXPLORE DATA ##############</span><span class="w">

</span><span class="c1">#### MOD09 raster image after hurricane Rita</span><span class="w">
</span><span class="n">r_after</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">brick</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">in_dir_var</span><span class="p">,</span><span class="n">infile_RITA_reflectance_date2</span><span class="p">))</span><span class="w">

</span><span class="c1">## Read band information since it is more informative!!</span><span class="w">
</span><span class="n">df_modis_band_info</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">in_dir_var</span><span class="p">,</span><span class="n">infile_modis_bands_information</span><span class="p">),</span><span class="w">
                                 </span><span class="n">sep</span><span class="o">=</span><span class="s2">","</span><span class="p">,</span><span class="w">
                                 </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">df_modis_band_info</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  band_name band_number start_wlength end_wlength
1       Red           3           620         670
2       NIR           4           841         876
3      Blue           1           459         479
4     Green           2           545         565
5     SWIR1           5          1230        1250
6     SWIR2           6          1628        1652
7     SWIR3           7          2105        2155
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">df_modis_band_info</span><span class="o">$</span><span class="n">band_number</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">)</span><span class="w">
</span><span class="n">write.table</span><span class="p">(</span><span class="n">df_modis_band_info</span><span class="p">,</span><span class="n">file.path</span><span class="p">(</span><span class="n">in_dir_var</span><span class="p">,</span><span class="n">infile_modis_bands_information</span><span class="p">),</span><span class="w">
            </span><span class="n">sep</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span><span class="w">

</span><span class="n">band_refl_order</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_modis_band_info</span><span class="o">$</span><span class="n">band_number</span><span class="w">

</span><span class="nf">names</span><span class="p">(</span><span class="n">r_after</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_modis_band_info</span><span class="o">$</span><span class="n">band_name</span><span class="w">

</span><span class="c1">## Use subset instead of $ if you want to wrap code into function</span><span class="w">
</span><span class="n">r_after_MNDWI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="s2">"Green"</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="s2">"SWIR2"</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="s2">"Green"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="s2">"SWIR2"</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">r_after_MNDWI</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part2/unnamed-chunk-1-1.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">r_after_NDVI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="s2">"NIR"</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="s2">"Red"</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="s2">"NIR"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="s2">"Red"</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">r_after_NDVI</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part2/unnamed-chunk-1-2.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">data_type_str</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dataType</span><span class="p">(</span><span class="n">r_after_NDVI</span><span class="p">)</span><span class="w">

</span><span class="n">NAvalue</span><span class="p">(</span><span class="n">r_after_NDVI</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">NA_flag_val</span><span class="w">
</span><span class="n">out_filename</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"ndvi_post_Rita"</span><span class="p">,</span><span class="s2">"_"</span><span class="p">,</span><span class="n">out_suffix</span><span class="p">,</span><span class="n">file_format</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w">
</span><span class="n">out_filename</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span><span class="n">out_filename</span><span class="p">)</span><span class="w">
</span><span class="n">writeRaster</span><span class="p">(</span><span class="n">r_after_NDVI</span><span class="p">,</span><span class="w">
            </span><span class="n">filename</span><span class="o">=</span><span class="n">out_filename</span><span class="p">,</span><span class="w">
            </span><span class="n">datatype</span><span class="o">=</span><span class="n">data_type_str</span><span class="p">,</span><span class="w">
            </span><span class="n">overwrite</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error in .local(x, filename, ...): Attempting to write a file to a path that does not exist:
  ./output_exercise6_03312018
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">NAvalue</span><span class="p">(</span><span class="n">r_after_MNDWI</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">NA_flag_val</span><span class="w">
</span><span class="n">out_filename</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"mndwi_post_Rita"</span><span class="p">,</span><span class="s2">"_"</span><span class="p">,</span><span class="n">out_suffix</span><span class="p">,</span><span class="n">file_format</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w">
</span><span class="n">out_filename</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span><span class="n">out_filename</span><span class="p">)</span><span class="w">
</span><span class="n">writeRaster</span><span class="p">(</span><span class="n">r_after_MNDWI</span><span class="p">,</span><span class="w">
            </span><span class="n">filename</span><span class="o">=</span><span class="n">out_filename</span><span class="p">,</span><span class="w">
            </span><span class="n">datatype</span><span class="o">=</span><span class="n">data_type_str</span><span class="p">,</span><span class="w">
            </span><span class="n">overwrite</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error in .local(x, filename, ...): Attempting to write a file to a path that does not exist:
  ./output_exercise6_03312018
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#training_data_sf &lt;- st_read("training1.shp")</span><span class="w">
</span><span class="c1">#1) vegetation and other (small water fraction)</span><span class="w">
</span><span class="c1">#2) Flooded vegetation</span><span class="w">
</span><span class="c1">#3) Flooded area, or water (lake etc)</span><span class="w">

</span><span class="n">class1_data_sf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_read</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">in_dir_var</span><span class="p">,</span><span class="s2">"class1_sites"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Reading layer `class1_sites' from data source `/nfs/public-data/training/class1_sites' using driver `ESRI Shapefile'
Simple feature collection with 6 features and 2 fields
geometry type:  POLYGON
dimension:      XY
bbox:           xmin: 1588619 ymin: 859495.9 xmax: 1830803 ymax: 941484.1
epsg (SRID):    NA
proj4string:    NA
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">class2_data_sf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_read</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">in_dir_var</span><span class="p">,</span><span class="s2">"class2_sites"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Reading layer `class2_sites' from data source `/nfs/public-data/training/class2_sites' using driver `ESRI Shapefile'
Simple feature collection with 8 features and 2 fields
geometry type:  MULTIPOLYGON
dimension:      XY
bbox:           xmin: 1605433 ymin: 848843.8 xmax: 1794265 ymax: 884027.8
epsg (SRID):    NA
proj4string:    NA
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">class3_data_sf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_read</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">in_dir_var</span><span class="p">,</span><span class="s2">"class3_sites"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Reading layer `class3_sites' from data source `/nfs/public-data/training/class3_sites' using driver `ESRI Shapefile'
Simple feature collection with 9 features and 2 fields
geometry type:  POLYGON
dimension:      XY
bbox:           xmin: 1587649 ymin: 845271.3 xmax: 1777404 ymax: 891073.1
epsg (SRID):    NA
proj4string:    NA
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="c1">### combine object, note they should be in the same projection system</span><span class="w">
</span><span class="n">class_data_sf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">class1_data_sf</span><span class="p">,</span><span class="n">class2_data_sf</span><span class="p">,</span><span class="n">class3_data_sf</span><span class="p">)</span><span class="w">
</span><span class="n">class_data_sf</span><span class="o">$</span><span class="n">poly_ID</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">class_data_sf</span><span class="p">)</span><span class="w"> </span><span class="c1">#unique ID for each polygon</span><span class="w">
</span><span class="n">nrow</span><span class="p">(</span><span class="n">class_data_sf</span><span class="p">)</span><span class="w"> </span><span class="c1"># 23 different polygons used at ground truth data</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 23
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">class_data_sp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as</span><span class="p">(</span><span class="n">class_data_sf</span><span class="p">,</span><span class="s2">"Spatial"</span><span class="p">)</span><span class="w">

</span><span class="n">r_x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">init</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="s2">"x"</span><span class="p">)</span><span class="w"> </span><span class="c1">#raster with coordinates x</span><span class="w">
</span><span class="n">r_y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">init</span><span class="p">(</span><span class="n">r_after</span><span class="p">,</span><span class="s2">"x"</span><span class="p">)</span><span class="w"> </span><span class="c1">#raster with coordiates y</span><span class="w">

</span><span class="n">r_stack</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stack</span><span class="p">(</span><span class="n">r_x</span><span class="p">,</span><span class="n">r_y</span><span class="p">,</span><span class="n">r_after</span><span class="p">,</span><span class="n">r_after_NDVI</span><span class="p">,</span><span class="n">r_after_MNDWI</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">r_stack</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span><span class="s2">"y"</span><span class="p">,</span><span class="s2">"Red"</span><span class="p">,</span><span class="s2">"NIR"</span><span class="p">,</span><span class="s2">"Blue"</span><span class="p">,</span><span class="s2">"Green"</span><span class="p">,</span><span class="s2">"SWIR1"</span><span class="p">,</span><span class="s2">"SWIR2"</span><span class="p">,</span><span class="s2">"SWIR3"</span><span class="p">,</span><span class="s2">"NDVI"</span><span class="p">,</span><span class="s2">"MNDWI"</span><span class="p">)</span><span class="w">
</span><span class="n">pixels_extracted_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">extract</span><span class="p">(</span><span class="n">r_stack</span><span class="p">,</span><span class="n">class_data_sp</span><span class="p">,</span><span class="n">df</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result

Warning in merge.data.frame(as.data.frame(x), as.data.frame(y), ...):
column name 'x' is duplicated in the result
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="nf">dim</span><span class="p">(</span><span class="n">pixels_extracted_df</span><span class="p">)</span><span class="w"> </span><span class="c1">#We have 1547 pixels extracted</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1547   12
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">class_data_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">class_data_sf</span><span class="w">
</span><span class="n">st_geometry</span><span class="p">(</span><span class="n">class_data_df</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w"> </span><span class="c1">#this will coerce the sf object into a data.frame</span><span class="w">

</span><span class="n">pixels_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">pixels_extracted_df</span><span class="p">,</span><span class="n">class_data_df</span><span class="p">,</span><span class="n">by.x</span><span class="o">=</span><span class="s2">"ID"</span><span class="p">,</span><span class="n">by.y</span><span class="o">=</span><span class="s2">"poly_ID"</span><span class="p">)</span><span class="w">

</span><span class="n">head</span><span class="p">(</span><span class="n">pixels_df</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ID       x       y        Red       NIR       Blue      Green     SWIR1
1  1 1615340 1615340 0.05304649 0.3035397 0.02652384 0.05662384 0.3101271
2  1 1614413 1614413 0.05782417 0.3295924 0.02751791 0.06305390 0.3453724
3  1 1615340 1615340 0.05735013 0.3037102 0.02596963 0.05654212 0.3176476
4  1 1616266 1616266 0.05805403 0.3081988 0.02711912 0.05750944 0.3229090
5  1 1617193 1617193 0.04147716 0.3058677 0.01839499 0.05076184 0.3003513
6  1 1618120 1618120 0.04209801 0.3089238 0.01832494 0.05200353 0.2943777
      SWIR2      SWIR3      NDVI      MNDWI record_ID class_ID
1 0.1936452 0.07864757 0.7024759 -0.5474962         1        1
2 0.2102322 0.08679578 0.7014884 -0.5385502         1        1
3 0.2073480 0.08732812 0.6823238 -0.5714722         1        1
4 0.2079238 0.08741243 0.6829839 -0.5666749         1        1
5 0.1692552 0.06590501 0.7611759 -0.5385644         1        1
6 0.1697936 0.06790353 0.7601402 -0.5310712         1        1
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">table</span><span class="p">(</span><span class="n">pixels_df</span><span class="o">$</span><span class="n">class_ID</span><span class="p">)</span><span class="w"> </span><span class="c1"># count by class of pixels ground truth data</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
  1   2   3 
508 285 754 
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="c1">######## Examining sites data used for the classification</span><span class="w">

</span><span class="c1">#Water</span><span class="w">
</span><span class="n">x_range</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">range</span><span class="p">(</span><span class="n">pixels_df</span><span class="o">$</span><span class="n">Green</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">y_range</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">range</span><span class="p">(</span><span class="n">pixels_df</span><span class="o">$</span><span class="n">NIR</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">

</span><span class="c1">###Add legend?</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">NIR</span><span class="o">~</span><span class="n">Green</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">x_range</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">y_range</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="n">subset</span><span class="p">(</span><span class="n">pixels_df</span><span class="p">,</span><span class="n">class_ID</span><span class="o">==</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">NIR</span><span class="o">~</span><span class="n">Green</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">subset</span><span class="p">(</span><span class="n">pixels_df</span><span class="p">,</span><span class="n">class_ID</span><span class="o">==</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">NIR</span><span class="o">~</span><span class="n">Green</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">subset</span><span class="p">(</span><span class="n">pixels_df</span><span class="p">,</span><span class="n">class_ID</span><span class="o">==</span><span class="m">3</span><span class="p">))</span><span class="w">
</span><span class="n">names_vals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"water class 1"</span><span class="p">,</span><span class="s2">"water class 2"</span><span class="p">,</span><span class="s2">"water class 3"</span><span class="p">)</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topleft"</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="n">names_vals</span><span class="p">,</span><span class="w">
       </span><span class="n">pt.cex</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"blue"</span><span class="p">,</span><span class="s2">"green"</span><span class="p">,</span><span class="s2">"red"</span><span class="p">),</span><span class="w">
       </span><span class="n">pch</span><span class="o">=</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="c1">#add circle symbol to line</span><span class="w">
       </span><span class="n">bty</span><span class="o">=</span><span class="s2">"n"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part2/unnamed-chunk-1-3.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="c1">## Let's use a palette that reflects wetness or level of water </span><span class="w">
</span><span class="n">col_palette</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"green"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">,</span><span class="s2">"darkblue"</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">NDVI</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">MNDWI</span><span class="p">,</span><span class="w">
     </span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w">
     </span><span class="n">cex</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="w">
     </span><span class="n">col</span><span class="o">=</span><span class="n">col_palette</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w">
     </span><span class="n">subset</span><span class="p">(</span><span class="n">pixels_df</span><span class="p">,</span><span class="n">class_ID</span><span class="o">==</span><span class="m">1</span><span class="p">))</span><span class="w">

</span><span class="n">points</span><span class="p">(</span><span class="n">NDVI</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">MNDWI</span><span class="p">,</span><span class="w">
       </span><span class="n">cex</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="w">
       </span><span class="n">col</span><span class="o">=</span><span class="n">col_palette</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="w">
       </span><span class="n">subset</span><span class="p">(</span><span class="n">pixels_df</span><span class="p">,</span><span class="n">class_ID</span><span class="o">==</span><span class="m">2</span><span class="p">))</span><span class="w">

</span><span class="n">points</span><span class="p">(</span><span class="n">NDVI</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">MNDWI</span><span class="p">,</span><span class="w">
       </span><span class="n">cex</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="w">
       </span><span class="n">col</span><span class="o">=</span><span class="n">col_palette</span><span class="p">[</span><span class="m">3</span><span class="p">],</span><span class="w">
       </span><span class="n">subset</span><span class="p">(</span><span class="n">pixels_df</span><span class="p">,</span><span class="n">class_ID</span><span class="o">==</span><span class="m">3</span><span class="p">))</span><span class="w">

</span><span class="n">names_vals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"vegetation"</span><span class="p">,</span><span class="s2">"wetland"</span><span class="p">,</span><span class="s2">"water"</span><span class="p">)</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topright"</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="n">names_vals</span><span class="p">,</span><span class="w">
       </span><span class="n">pt.cex</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col_palette</span><span class="p">,</span><span class="w">
       </span><span class="n">pch</span><span class="o">=</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="c1">#add circle symbol to line</span><span class="w">
       </span><span class="n">bty</span><span class="o">=</span><span class="s2">"n"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part2/unnamed-chunk-1-4.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">histogram</span><span class="p">(</span><span class="n">r_after</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part2/unnamed-chunk-1-5.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">pixels_df</span><span class="o">$</span><span class="n">class_ID</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">pixels_df</span><span class="o">$</span><span class="n">class_ID</span><span class="p">,</span><span class="w">
                    </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">),</span><span class="w">
                    </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">names_vals</span><span class="p">)</span><span class="w">

</span><span class="n">boxplot</span><span class="p">(</span><span class="n">MNDWI</span><span class="o">~</span><span class="n">class_ID</span><span class="p">,</span><span class="w">
        </span><span class="n">pixels_df</span><span class="p">,</span><span class="w">
        </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"category"</span><span class="p">,</span><span class="w">
        </span><span class="n">main</span><span class="o">=</span><span class="s2">"Boxplot for MNDWI per class"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part2/unnamed-chunk-1-6.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="c1">###############################################</span><span class="w">
</span><span class="c1">##### PART II: Split training and testing ##############</span><span class="w">

</span><span class="c1">##let's keep 30% of data for testing for each class</span><span class="w">

</span><span class="n">pixels_df</span><span class="o">$</span><span class="n">pix_ID</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">pixels_df</span><span class="p">)</span><span class="w">
</span><span class="n">prop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.3</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">pixels_df</span><span class="o">$</span><span class="n">class_ID</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
vegetation    wetland      water 
       508        285        754 
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">100</span><span class="p">)</span><span class="w"> </span><span class="c1">## set random seed for reproducibility</span><span class="w">

</span><span class="c1">### This is for one class:</span><span class="w">
</span><span class="c1">##Better as a function but we use a loop for clarity here:</span><span class="w">

</span><span class="n">list_data_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="s2">"list"</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">level_labels</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">names_vals</span><span class="w">

</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">){</span><span class="w">
  </span><span class="n">data_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">pixels_df</span><span class="p">,</span><span class="n">class_ID</span><span class="o">==</span><span class="n">level_labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w">
  </span><span class="n">data_df</span><span class="o">$</span><span class="n">pix_id</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span><span class="w">
  </span><span class="n">indices</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.vector</span><span class="p">(</span><span class="n">createDataPartition</span><span class="p">(</span><span class="n">data_df</span><span class="o">$</span><span class="n">pix_ID</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span><span class="n">list</span><span class="o">=</span><span class="nb">F</span><span class="p">))</span><span class="w">
  </span><span class="n">data_df</span><span class="o">$</span><span class="n">training</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">data_df</span><span class="o">$</span><span class="n">pix_id</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">indices</span><span class="p">)</span><span class="w">
  </span><span class="n">list_data_df</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data_df</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">data_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">do.call</span><span class="p">(</span><span class="n">rbind</span><span class="p">,</span><span class="n">list_data_df</span><span class="p">)</span><span class="w">

</span><span class="nf">dim</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1547   17
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ID       x       y        Red       NIR       Blue      Green     SWIR1
1  1 1615340 1615340 0.05304649 0.3035397 0.02652384 0.05662384 0.3101271
2  1 1614413 1614413 0.05782417 0.3295924 0.02751791 0.06305390 0.3453724
3  1 1615340 1615340 0.05735013 0.3037102 0.02596963 0.05654212 0.3176476
4  1 1616266 1616266 0.05805403 0.3081988 0.02711912 0.05750944 0.3229090
5  1 1617193 1617193 0.04147716 0.3058677 0.01839499 0.05076184 0.3003513
6  1 1618120 1618120 0.04209801 0.3089238 0.01832494 0.05200353 0.2943777
      SWIR2      SWIR3      NDVI      MNDWI record_ID   class_ID pix_ID
1 0.1936452 0.07864757 0.7024759 -0.5474962         1 vegetation      1
2 0.2102322 0.08679578 0.7014884 -0.5385502         1 vegetation      2
3 0.2073480 0.08732812 0.6823238 -0.5714722         1 vegetation      3
4 0.2079238 0.08741243 0.6829839 -0.5666749         1 vegetation      4
5 0.1692552 0.06590501 0.7611759 -0.5385644         1 vegetation      5
6 0.1697936 0.06790353 0.7601402 -0.5310712         1 vegetation      6
  pix_id training
1      1        0
2      2        1
3      3        0
4      4        0
5      5        1
6      6        0
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">data_training</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">data_df</span><span class="p">,</span><span class="n">training</span><span class="o">==</span><span class="m">1</span><span class="p">)</span><span class="w">

</span><span class="c1">###############################################</span><span class="w">
</span><span class="c1">##### PART III: Generate classification using CART and SVM ##############</span><span class="w">

</span><span class="c1">############### Using Classification and Regression Tree model (CART) #########</span><span class="w">

</span><span class="c1">## Fit model using training data for CART</span><span class="w">
</span><span class="n">mod_rpart</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rpart</span><span class="p">(</span><span class="n">class_ID</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Red</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">NIR</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Blue</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Green</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SWIR1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SWIR2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SWIR3</span><span class="p">,</span><span class="w">
                   </span><span class="n">method</span><span class="o">=</span><span class="s2">"class"</span><span class="p">,</span><span class="w"> 
                   </span><span class="n">data</span><span class="o">=</span><span class="n">data_training</span><span class="p">)</span><span class="w">

</span><span class="c1"># Plot the fitted  classification tree</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">mod_rpart</span><span class="p">,</span><span class="w"> </span><span class="n">uniform</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s2">"Classification Tree"</span><span class="p">)</span><span class="w">
</span><span class="n">text</span><span class="p">(</span><span class="n">mod_rpart</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">.8</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part2/unnamed-chunk-1-7.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="c1"># Now predict the subset data based on the model; prediction for entire area takes longer time</span><span class="w">
</span><span class="n">raster_out_filename</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"r_predicted_rpart_"</span><span class="p">,</span><span class="n">out_suffix</span><span class="p">,</span><span class="n">file_format</span><span class="p">)</span><span class="w">
</span><span class="n">r_predicted_rpart</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">r_stack</span><span class="p">,</span><span class="n">mod_rpart</span><span class="p">,</span><span class="w"> 
                             </span><span class="n">type</span><span class="o">=</span><span class="s1">'class'</span><span class="p">,</span><span class="w">
                             </span><span class="n">filename</span><span class="o">=</span><span class="n">raster_out_filename</span><span class="p">,</span><span class="w">
                             </span><span class="n">progress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'text'</span><span class="p">,</span><span class="w">
                             </span><span class="n">overwrite</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
  |                                                                       
  |                                                                 |   0%
  |                                                                       
  |================                                                 |  25%
  |                                                                       
  |================================                                 |  50%
  |                                                                       
  |=================================================                |  75%
  |                                                                       
  |=================================================================| 100%

</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_predicted_rpart</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part2/unnamed-chunk-1-8.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">r_predicted_rpart</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ratify</span><span class="p">(</span><span class="n">r_predicted_rpart</span><span class="p">)</span><span class="w">
</span><span class="n">rat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">r_predicted_rpart</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="n">rat</span><span class="o">$</span><span class="n">legend</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"vegetation"</span><span class="p">,</span><span class="s2">"wetland"</span><span class="p">,</span><span class="s2">"water"</span><span class="p">)</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">r_predicted_rpart</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rat</span><span class="w">
</span><span class="n">levelplot</span><span class="p">(</span><span class="n">r_predicted_rpart</span><span class="p">,</span><span class="w"> </span><span class="n">maxpixels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1e6</span><span class="p">,</span><span class="w">
          </span><span class="n">col.regions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"green"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">,</span><span class="s2">"darkblue"</span><span class="p">),</span><span class="w">
          </span><span class="n">scales</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">draw</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">),</span><span class="w">
          </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Classification Tree"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part2/unnamed-chunk-1-9.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="c1">############### Using Support Vector Machine #########</span><span class="w">

</span><span class="c1">## set class_ID as factor to generate classification</span><span class="w">

</span><span class="n">mod_svm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svm</span><span class="p">(</span><span class="n">class_ID</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Red</span><span class="w"> </span><span class="o">+</span><span class="n">NIR</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Blue</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Green</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SWIR1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SWIR2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SWIR3</span><span class="p">,</span><span class="w">
               </span><span class="n">data</span><span class="o">=</span><span class="n">data_training</span><span class="p">,</span><span class="w">
               </span><span class="n">method</span><span class="o">=</span><span class="s2">"C-classification"</span><span class="p">,</span><span class="w">
               </span><span class="n">kernel</span><span class="o">=</span><span class="s2">"linear"</span><span class="p">)</span><span class="w"> </span><span class="c1"># can be radial</span><span class="w">

</span><span class="n">summary</span><span class="p">(</span><span class="n">mod_svm</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Call:
svm(formula = class_ID ~ Red + NIR + Blue + Green + SWIR1 + SWIR2 + 
    SWIR3, data = data_training, method = "C-classification", 
    kernel = "linear")


Parameters:
   SVM-Type:  C-classification 
 SVM-Kernel:  linear 
       cost:  1 
      gamma:  0.1428571 

Number of Support Vectors:  110

 ( 12 54 44 )


Number of Classes:  3 

Levels: 
 vegetation wetland water
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="c1"># Now predict the subset data based on the model; prediction for entire area takes longer time</span><span class="w">
</span><span class="n">raster_outfilename</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"r_predicted_svm_"</span><span class="p">,</span><span class="n">out_suffix</span><span class="p">,</span><span class="n">file_format</span><span class="p">)</span><span class="w">
</span><span class="n">r_predicted_svm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">r_stack</span><span class="p">,</span><span class="w"> </span><span class="n">mod_svm</span><span class="p">,</span><span class="w">
                           </span><span class="n">progress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'text'</span><span class="p">,</span><span class="w">
                           </span><span class="n">filename</span><span class="o">=</span><span class="n">raster_outfilename</span><span class="p">,</span><span class="w">
                           </span><span class="n">overwrite</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
  |                                                                       
  |                                                                 |   0%
  |                                                                       
  |================                                                 |  25%
  |                                                                       
  |================================                                 |  50%
  |                                                                       
  |=================================================                |  75%
  |                                                                       
  |=================================================================| 100%

</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">r_predicted_svm</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part2/unnamed-chunk-1-10.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">histogram</span><span class="p">(</span><span class="n">r_predicted_svm</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part2/unnamed-chunk-1-11.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">r_predicted_svm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ratify</span><span class="p">(</span><span class="n">r_predicted_svm</span><span class="p">)</span><span class="w">
</span><span class="n">rat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">r_predicted_svm</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="n">rat</span><span class="o">$</span><span class="n">legend</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"vegetation"</span><span class="p">,</span><span class="s2">"wetland"</span><span class="p">,</span><span class="s2">"water"</span><span class="p">)</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">r_predicted_svm</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rat</span><span class="w">
</span><span class="n">levelplot</span><span class="p">(</span><span class="n">r_predicted_svm</span><span class="p">,</span><span class="w"> </span><span class="n">maxpixels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1e6</span><span class="p">,</span><span class="w">
          </span><span class="n">col.regions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"green"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">,</span><span class="s2">"darkblue"</span><span class="p">),</span><span class="w">
          </span><span class="n">scales</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">draw</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">),</span><span class="w">
          </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SVM classification"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/sesync-ci/remote-sensing-classification-lesson@v0.1/docs/images/part2/unnamed-chunk-1-12.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r captioned text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="c1">###############################################</span><span class="w">
</span><span class="c1">##### PART IV: Compare methods for the performance ##############</span><span class="w">

</span><span class="nf">dim</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span><span class="w"> </span><span class="c1"># full dataset, let's use data points for testing</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1547   17
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#omit values that contain NA, because may be problematic with SVM.</span><span class="w">
</span><span class="n">data_testing</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">na.omit</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">data_df</span><span class="p">,</span><span class="n">training</span><span class="o">==</span><span class="m">0</span><span class="p">))</span><span class="w"> 
</span><span class="nf">dim</span><span class="p">(</span><span class="n">data_testing</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 450  17
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#### Predict on testing data using rpart model fitted with training data</span><span class="w">
</span><span class="n">testing_rpart</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">mod_rpart</span><span class="p">,</span><span class="w"> </span><span class="n">data_testing</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'class'</span><span class="p">)</span><span class="w">
</span><span class="c1">#### Predict on testing data using SVM model fitted with training data</span><span class="w">
</span><span class="n">testing_svm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">mod_svm</span><span class="p">,</span><span class="n">data_testing</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s1">'class'</span><span class="p">)</span><span class="w">

</span><span class="c1">## Predicted classes:</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">testing_svm</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>testing_svm
vegetation    wetland      water 
       150         78        222 
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#### Generate confusion matrix to assess the performance of the model</span><span class="w">

</span><span class="n">tb_rpart</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">table</span><span class="p">(</span><span class="n">testing_rpart</span><span class="p">,</span><span class="n">data_testing</span><span class="o">$</span><span class="n">class_ID</span><span class="p">)</span><span class="w">
</span><span class="n">tb_svm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">table</span><span class="p">(</span><span class="n">testing_svm</span><span class="p">,</span><span class="n">data_testing</span><span class="o">$</span><span class="n">class_ID</span><span class="p">)</span><span class="w">

</span><span class="c1">#testing_rpart: map prediction in the rows</span><span class="w">
</span><span class="c1">#data_test$class_ID: ground truth data in the columns</span><span class="w">
</span><span class="c1">#http://spatial-analyst.net/ILWIS/htm/ilwismen/confusion_matrix.htm</span><span class="w">
</span><span class="c1">#Producer accuracy: it is the fraction of correctly classified pixels with regard to all pixels </span><span class="w">
</span><span class="c1">#of that ground truth class. </span><span class="w">

</span><span class="n">table</span><span class="p">(</span><span class="n">testing_rpart</span><span class="p">)</span><span class="w"> </span><span class="c1">#classification, map results</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>testing_rpart
vegetation    wetland      water 
       149         77        224 
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">table</span><span class="p">(</span><span class="n">data_testing</span><span class="o">$</span><span class="n">class_ID</span><span class="p">)</span><span class="w"> </span><span class="c1">#reference, ground truth in columns</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
vegetation    wetland      water 
       149         84        217 
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">tb_rpart</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">tb_rpart</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w"> </span><span class="c1">#producer accuracy</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 0.9798658
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">tb_svm</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">tb_svm</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w"> </span><span class="c1">#producer accuracy</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#overall accuracy for svm</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="n">diag</span><span class="p">(</span><span class="n">tb_svm</span><span class="p">))</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">testing_svm</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 0.9644444
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#overall accuracy for rpart</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="n">diag</span><span class="p">(</span><span class="n">tb_rpart</span><span class="p">))</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">testing_rpart</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 0.9444444
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#Generate more accuracy measurements from CARET</span><span class="w">
</span><span class="n">accuracy_info_svm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">testing_svm</span><span class="p">,</span><span class="n">data_testing</span><span class="o">$</span><span class="n">class_ID</span><span class="p">,</span><span class="w"> </span><span class="n">positive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span><span class="w">
</span><span class="n">accuracy_info_rpart</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">testing_rpart</span><span class="p">,</span><span class="n">data_testing</span><span class="o">$</span><span class="n">class_ID</span><span class="p">,</span><span class="w"> </span><span class="n">positive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span><span class="w">

</span><span class="n">accuracy_info_rpart</span><span class="o">$</span><span class="n">overall</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      Accuracy          Kappa  AccuracyLower  AccuracyUpper   AccuracyNull 
  9.444444e-01   9.101603e-01   9.190787e-01   9.637284e-01   4.822222e-01 
AccuracyPValue  McnemarPValue 
 1.266887e-101            NaN 
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="n">accuracy_info_svm</span><span class="o">$</span><span class="n">overall</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      Accuracy          Kappa  AccuracyLower  AccuracyUpper   AccuracyNull 
  9.644444e-01   9.425947e-01   9.429011e-01   9.795429e-01   4.822222e-01 
AccuracyPValue  McnemarPValue 
 9.645095e-114            NaN 
</code></pre></div></div>

<div class="language-r text-document highlighter-rouge" title="worksheet-3-2.R"><div class="highlight"><pre class="highlight"><code><span class="c1">#### write out the results:</span><span class="w">
</span><span class="n">write.table</span><span class="p">(</span><span class="n">accuracy_info_rpart</span><span class="o">$</span><span class="n">table</span><span class="p">,</span><span class="s2">"confusion_matrix_rpart.txt"</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span><span class="w">
</span><span class="n">write.table</span><span class="p">(</span><span class="n">accuracy_info_svm</span><span class="o">$</span><span class="n">table</span><span class="p">,</span><span class="s2">"confusion_matrix_svm.txt"</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span><span class="w">

</span><span class="c1">############################ End of Script ###################################</span><span class="w">
</span></code></pre></div></div>

<p class="ToS"><a href="#/slides/part2">Top of Section</a></p>

<hr />



      </div>
    </div>
  <script>
 var collection = document.getElementsByClassName('rlib');
 for (var i = 0; i < collection.length; i++) {
     var a = collection[i];
     a.href = 'https://cran.r-project.org/package=' + a.innerText;
 };
 var collection = document.getElementsByClassName('pylib');
 for (var i = 0; i < collection.length; i++) {
     var a = collection[i];
     a.href = 'https://pypi.python.org/pypi/' + a.innerText;
 };
</script>

  </body>
</html>
